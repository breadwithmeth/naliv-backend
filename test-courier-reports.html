<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç API –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –∫—É—Ä—å–µ—Ä–∞–º</ti        <div class="section" style="background-color: #e8f5e8; border-left: 4px solid #4CAF50;">
            <h3>üìã –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –¥–æ—Å—Ç–∞–≤–∫–∞–º</h3>
            <p>–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 4 (–¥–æ—Å—Ç–∞–≤–ª–µ–Ω):</p>
            <ul>
                <li><strong>–¢–æ–ª—å–∫–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</strong> - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 4</li>
                <li><strong>–°—Ç–∞—Ç—É—Å –∏–∑ order_status</strong> - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã order_status</li>
                <li><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—É—Ä—å–µ—Ä–µ</strong> - –µ—Å–ª–∏ –∫—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</li>
                <li><strong>–ü—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong> - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –∏ –≤—ã—Ä—É—á–∫–∞</li>
                <li><strong>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏</strong> - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç—ã</li>
            </ul>
        </div>style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #555;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input[type="text"], input[type="date"], input[type="datetime-local"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input:focus {
            border-color: #4CAF50;
            outline: none;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .detailed-btn {
            background-color: #2196F3;
        }
        .detailed-btn:hover {
            background-color: #1976D2;
        }
        .clear-btn {
            background-color: #ff9800;
        }
        .clear-btn:hover {
            background-color: #f57c00;
        }
        .response {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 600px;
            overflow-y: auto;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .flex-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .flex-row .form-group {
            flex: 1;
            min-width: 200px;
        }
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 10px 0;
        }
        .summary-card h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        .summary-card .number {
            font-size: 24px;
            font-weight: bold;
        }
        .tabs {
            display: flex;
            background-color: #f1f1f1;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .tab.active {
            background-color: #4CAF50;
            color: white;
        }
        .tab:hover {
            background-color: #45a049;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä –¢–µ—Å—Ç API –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –∫—É—Ä—å–µ—Ä–∞–º (–°—Ç–∞—Ç—É—Å –∏–∑ order_status)</h1>
        
        <div class="section" style="background-color: #e8f5e8; border-left: 4px solid #4CAF50;">
            <h3>ÔøΩ –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –¥–æ—Å—Ç–∞–≤–∫–∞–º</h3>
            <p>–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 4 (–¥–æ—Å—Ç–∞–≤–ª–µ–Ω):</p>
            <ul>
                <li><strong>–¢–æ–ª—å–∫–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</strong> - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 4</li>
                <li><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—É—Ä—å–µ—Ä–µ</strong> - –µ—Å–ª–∏ –∫—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –µ–≥–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</li>
                <li><strong>–ü—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong> - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –∏ –≤—ã—Ä—É—á–∫–∞</li>
                <li><strong>–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏</strong> - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç—ã</li>
            </ul>
        </div>
        
        <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å–∞ -->
        <div class="section">
            <h2>üîë –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å–∞</h2>
            <div class="form-group">
                <label for="businessToken">–¢–æ–∫–µ–Ω –±–∏–∑–Ω–µ—Å–∞:</label>
                <input type="text" id="businessToken" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–∏–∑–Ω–µ—Å–∞">
            </div>
            <button onclick="testBusinessAuth()">üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('general')">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</div>
            <div class="tab" onclick="switchTab('detailed')">–ó–∞–∫–∞–∑—ã –∫—É—Ä—å–µ—Ä–∞</div>
        </div>

        <!-- –û–±—â–∏–π –æ—Ç—á–µ—Ç -->
        <div id="general" class="tab-content active">
            <div class="section">
                <h2>ÔøΩ –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</h2>
                <p>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º 4 (–¥–æ—Å—Ç–∞–≤–ª–µ–Ω) —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫—É—Ä—å–µ—Ä–µ</p>
                <div class="flex-row">
                    <div class="form-group">
                        <label for="startDate">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
                        <input type="datetime-local" id="startDate" value="2025-08-01T00:00">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É (YYYY-MM-DD) –∏–ª–∏ –¥–∞—Ç—É —Å –≤—Ä–µ–º–µ–Ω–µ–º
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="endDate">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                        <input type="datetime-local" id="endDate" value="2025-08-12T23:59">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            –ü—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –¥–∞—Ç—ã –≤—Ä–µ–º—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ 23:59:59
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="cityId">ID –≥–æ—Ä–æ–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                        <input type="number" id="cityId" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label for="courierId">ID –∫—É—Ä—å–µ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                        <input type="number" id="courierId" placeholder="5">
                    </div>
                </div>
                <button onclick="getGeneralReport()">üìä –ü–æ–ª—É—á–∏—Ç—å –æ–±—â–∏–π –æ—Ç—á–µ—Ç</button>
                <button onclick="clearResponse()" class="clear-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>

        <!-- –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç -->
        <div id="detailed" class="tab-content">
            <div class="section">
                <h2>ÔøΩ –ó–∞–∫–∞–∑—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞</h2>
                <p>–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –∫—É—Ä—å–µ—Ä–∞</p>
                <div class="flex-row">
                    <div class="form-group">
                        <label for="detailedCourierId">ID –∫—É—Ä—å–µ—Ä–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                        <input type="number" id="detailedCourierId" value="1" placeholder="1">
                    </div>
                    <div class="form-group">
                        <label for="detailedStartDate">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞:</label>
                        <input type="datetime-local" id="detailedStartDate" value="2025-08-01T00:00">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            –§–æ—Ä–º–∞—Ç: YYYY-MM-DD –∏–ª–∏ YYYY-MM-DD HH:mm:ss
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="detailedEndDate">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
                        <input type="datetime-local" id="detailedEndDate" value="2025-08-12T23:59">
                        <small style="color: #666; display: block; margin-top: 5px;">
                            –ü—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ —Ç–æ–ª—å–∫–æ –¥–∞—Ç—ã –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ –∫–æ–Ω–µ—Ü –¥–Ω—è
                        </small>
                    </div>
                </div>
                <button onclick="getDetailedReport()" class="detailed-btn">üîç –ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç</button>
                <button onclick="clearResponse()" class="clear-btn">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>

        <!-- –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ -->
        <div id="response"></div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:3000/api';

        function switchTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showResponse(data, isError = false) {
            const responseDiv = document.getElementById('response');
            responseDiv.className = 'response ' + (isError ? 'error' : 'success');
            
            if (!isError && data.success) {
                responseDiv.innerHTML = formatReportResponse(data);
            } else {
                responseDiv.textContent = JSON.stringify(data, null, 2);
            }
        }

        function showInfo(message) {
            const responseDiv = document.getElementById('response');
            responseDiv.className = 'response info';
            responseDiv.textContent = message;
        }

        function clearResponse() {
            document.getElementById('response').innerHTML = '';
        }

        function formatReportResponse(data) {
            if (data.data.courier_info) {
                // –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –∫—É—Ä—å–µ—Ä–∞
                return formatDetailedReport(data);
            } else {
                // –û–±—â–∏–π –æ—Ç—á–µ—Ç
                return formatGeneralReport(data);
            }
        }

        function formatGeneralReport(data) {
            const report = data.data;
            let html = `
                <div class="summary-card">
                    <h3>üìä –°–≤–æ–¥–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥: ${report.period.start_date} - ${report.period.end_date}</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div>
                            <div class="number">${report.summary.total_orders}</div>
                            <div>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                        </div>
                        <div>
                            <div class="number">${report.summary.total_delivered}</div>
                            <div>–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</div>
                        </div>
                        <div>
                            <div class="number">${report.summary.delivery_success_rate}%</div>
                            <div>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                        </div>
                        <div>
                            <div class="number">${report.summary.active_couriers}</div>
                            <div>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫—É—Ä—å–µ—Ä–æ–≤</div>
                        </div>
                        <div>
                            <div class="number">${report.summary.total_delivery_revenue.toLocaleString()} ‚Ç∏</div>
                            <div>–í—ã—Ä—É—á–∫–∞ —Å –¥–æ—Å—Ç–∞–≤–∫–∏</div>
                        </div>
                        <div>
                            <div class="number">${Math.round(report.summary.avg_delivery_price)} ‚Ç∏</div>
                            <div>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</div>
                        </div>
                    </div>
                </div>
            `;

            if (report.top_couriers.length > 0) {
                html += `
                    <h3>üèÜ –¢–æ–ø –∫—É—Ä—å–µ—Ä–æ–≤</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>–ö—É—Ä—å–µ—Ä</th>
                                <th>–ì–æ—Ä–æ–¥</th>
                                <th>–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</th>
                                <th>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</th>
                                <th>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                report.top_couriers.forEach(courier => {
                    html += `
                        <tr>
                            <td>${courier.courier_name} (${courier.courier_login})</td>
                            <td>${courier.city_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                            <td>${courier.delivered_orders}</td>
                            <td>${courier.total_delivery_earnings.toLocaleString()} ‚Ç∏</td>
                            <td>${courier.success_rate}%</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }

            if (report.daily_statistics.length > 0) {
                html += `
                    <h3>üìÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–Ω—è–º</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ó–∞–∫–∞–∑–æ–≤</th>
                                <th>–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</th>
                                <th>–ö—É—Ä—å–µ—Ä–æ–≤</th>
                                <th>–í—ã—Ä—É—á–∫–∞</th>
                                <th>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                report.daily_statistics.forEach(day => {
                    html += `
                        <tr>
                            <td>${day.date}</td>
                            <td>${day.orders_count}</td>
                            <td>${day.delivered_count}</td>
                            <td>${day.active_couriers_count}</td>
                            <td>${day.daily_delivery_revenue.toLocaleString()} ‚Ç∏</td>
                            <td>${day.success_rate}%</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }

            return html;
        }

        function formatDetailedReport(data) {
            const report = data.data;
            let html = `
                <div class="summary-card">
                    <h3>üë§ ${report.courier_info.full_name} (${report.courier_info.login})</h3>
                    <p>–ì–æ—Ä–æ–¥: ${report.courier_info.city_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                    <p>–ü–µ—Ä–∏–æ–¥: ${report.period.start_date} - ${report.period.end_date}</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div class="summary-card">
                        <h3>üì¶ –ó–∞–∫–∞–∑—ã</h3>
                        <div class="number">${report.statistics.total_orders}</div>
                        <small>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</small>
                    </div>
                    <div class="summary-card">
                        <h3>‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</h3>
                        <div class="number">${report.statistics.delivered_orders}</div>
                        <small>${report.statistics.success_rate}% —É—Å–ø–µ—à–Ω–æ—Å—Ç—å</small>
                    </div>
                    <div class="summary-card">
                        <h3>üí∞ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</h3>
                        <div class="number">${report.statistics.total_earnings.toLocaleString()} ‚Ç∏</div>
                        <small>–°—Ä–µ–¥–Ω—è—è –¥–æ—Å—Ç–∞–≤–∫–∞: ${report.statistics.avg_delivery_price} ‚Ç∏</small>
                    </div>
                    <div class="summary-card">
                        <h3>‚è±Ô∏è –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏</h3>
                        <div class="number">${report.statistics.avg_delivery_time_minutes}</div>
                        <small>–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è (–º–∏–Ω)</small>
                    </div>
                </div>
            `;

            if (report.orders.length > 0) {
                html += `
                    <h3>üìã –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID –∑–∞–∫–∞–∑–∞</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–ú–∞–≥–∞–∑–∏–Ω</th>
                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                <th>–¶–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</th>
                                <th>–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏</th>
                                <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                report.orders.forEach(order => {
                    const statusColor = order.status === 4 ? '#28a745' : 
                                       order.status === 5 ? '#dc3545' : 
                                       order.status === 3 ? '#007bff' : '#6c757d';
                    
                    html += `
                        <tr>
                            <td>#${order.order_id}</td>
                            <td style="color: ${statusColor}; font-weight: bold;">${order.status_name}</td>
                            <td>${order.business_name}</td>
                            <td>${order.customer_name}</td>
                            <td>${order.delivery_price.toLocaleString()} ‚Ç∏</td>
                            <td>${order.delivery_time_minutes ? order.delivery_time_minutes + ' –º–∏–Ω' : '-'}</td>
                            <td>${new Date(order.order_created).toLocaleDateString('ru-RU')}</td>
                        </tr>
                    `;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            }

            return html;
        }

        async function makeRequest(endpoint, params = {}) {
            try {
                showInfo(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: GET ${endpoint}...`);
                
                const headers = {
                    'Content-Type': 'application/json'
                };

                const businessToken = document.getElementById('businessToken').value;
                if (businessToken) {
                    headers['Authorization'] = `Bearer ${businessToken}`;
                }

                const url = new URL(`${BASE_URL}${endpoint}`);
                Object.keys(params).forEach(key => {
                    if (params[key]) {
                        url.searchParams.append(key, params[key]);
                    }
                });

                const response = await fetch(url, { headers });
                const data = await response.json();

                if (response.ok) {
                    showResponse(data);
                    return data;
                } else {
                    showResponse(data, true);
                    return null;
                }
            } catch (error) {
                showResponse({ error: error.message }, true);
                return null;
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏
        function formatDateTime(dateTimeValue) {
            if (!dateTimeValue) return '';
            
            // –ï—Å–ª–∏ —ç—Ç–æ datetime-local –∑–Ω–∞—á–µ–Ω–∏–µ (—Ñ–æ—Ä–º–∞—Ç: YYYY-MM-DDTHH:mm)
            if (dateTimeValue.includes('T')) {
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
                return dateTimeValue.replace('T', ' ') + ':00'; // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–∫—É–Ω–¥—ã
            }
            
            // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –¥–∞—Ç–∞
            return dateTimeValue;
        }

        async function getGeneralReport() {
            const startDateRaw = document.getElementById('startDate').value;
            const endDateRaw = document.getElementById('endDate').value;
            const cityId = document.getElementById('cityId').value;
            const courierId = document.getElementById('courierId').value;

            if (!startDateRaw || !endDateRaw) {
                showResponse({ error: '–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è' }, true);
                return;
            }

            const params = {
                start_date: formatDateTime(startDateRaw),
                end_date: formatDateTime(endDateRaw)
            };

            if (cityId) params.city_id = cityId;
            if (courierId) params.courier_id = courierId;

            await makeRequest('/businesses/reports/couriers', params);
        }

        async function getDetailedReport() {
            const courierId = document.getElementById('detailedCourierId').value;
            const startDateRaw = document.getElementById('detailedStartDate').value;
            const endDateRaw = document.getElementById('detailedEndDate').value;

            if (!courierId) {
                showResponse({ error: '–£–∫–∞–∂–∏—Ç–µ ID –∫—É—Ä—å–µ—Ä–∞' }, true);
                return;
            }

            if (!startDateRaw || !endDateRaw) {
                showResponse({ error: '–£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è' }, true);
                return;
            }

            const params = {
                start_date: formatDateTime(startDateRaw),
                end_date: formatDateTime(endDateRaw)
            };

            await makeRequest(`/businesses/reports/courier/${courierId}`, params);
        }

        async function testBusinessAuth() {
            const businessToken = document.getElementById('businessToken').value;
            
            if (!businessToken) {
                showResponse({ error: '–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–∏–∑–Ω–µ—Å–∞' }, true);
                return;
            }

            try {
                showInfo('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ –±–∏–∑–Ω–µ—Å–∞...');
                
                const headers = {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${businessToken}`
                };

                // –î–µ–ª–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–∞
                const response = await fetch(`${BASE_URL}/businesses`, { headers });
                const data = await response.json();

                if (response.ok) {
                    showResponse({
                        success: true,
                        message: '–¢–æ–∫–µ–Ω –±–∏–∑–Ω–µ—Å–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω',
                        status: response.status
                    });
                } else {
                    showResponse(data, true);
                }
            } catch (error) {
                showResponse({ error: error.message }, true);
            }
        }

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        window.onload = function() {
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekAgoStr = weekAgo.toISOString().split('T')[0];
            
            document.getElementById('endDate').value = today;
            document.getElementById('detailedEndDate').value = today;
            document.getElementById('startDate').value = weekAgoStr;
            document.getElementById('detailedStartDate').value = weekAgoStr;
        };
    </script>
</body>
</html>
