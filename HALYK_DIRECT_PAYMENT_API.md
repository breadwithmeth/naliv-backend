# API –¥–ª—è –æ–ø–ª–∞—Ç—ã –ø–æ –∫–æ–¥—É –∫–∞—Ä—Ç—ã Halyk

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ú–µ—Ç–æ–¥ `payWithSavedCard` –±—ã–ª –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–∞–ø—Ä—è–º—É—é —Å –∫–æ–¥–æ–º –∫–∞—Ä—Ç—ã Halyk Bank (`halyk_card_id`) –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `halyk_saved_cards`.

## –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

- ‚ùå **–£–±—Ä–∞–Ω–∞** –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ä—Ç—ã –ø–æ —Ç–∞–±–ª–∏—Ü–µ `halyk_saved_cards`
- ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞** –ø—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å –∫–æ–¥–æ–º –∫–∞—Ä—Ç—ã Halyk
- ‚úÖ **–£–ø—Ä–æ—â–µ–Ω** –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω** –º–∞—Ä—à—Ä—É—Ç –Ω–∞ `/api/payments/pay-with-halyk-card`

## Endpoints

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å halyk_id
**POST** `/api/orders/create-user-order`

### –û–ø–ª–∞—Ç–∞ –ø–æ –∫–æ–¥—É –∫–∞—Ä—Ç—ã Halyk
**POST** `/api/payments/pay-with-halyk-card`

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–¢—Ä–µ–±—É–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ:
```
Authorization: Bearer {jwt_token}
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|-------------|----------|
| `business_id` | number | ‚úÖ | ID –±–∏–∑–Ω–µ—Å–∞ |
| `halyk_id` | string | ‚úÖ | –¢–æ–∫–µ–Ω –∫–∞—Ä—Ç—ã Halyk Bank –¥–ª—è –∞–≤—Ç–æ–ø–ª–∞—Ç–µ–∂–∞ |
| `street` | string | ‚úÖ | –ù–∞–∑–≤–∞–Ω–∏–µ —É–ª–∏—Ü—ã |
| `house` | string | ‚úÖ | –ù–æ–º–µ—Ä –¥–æ–º–∞ |
| `apartment` | string | ‚ùå | –ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã |
| `lat` | number | ‚úÖ | –®–∏—Ä–æ—Ç–∞ –∞–¥—Ä–µ—Å–∞ |
| `lon` | number | ‚úÖ | –î–æ–ª–≥–æ—Ç–∞ –∞–¥—Ä–µ—Å–∞ |
| `items` | array | ‚úÖ | –ú–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–∫–∞–∑–∞ |
| `delivery_type` | string | ‚úÖ | –¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏: DELIVERY, PICKUP, SCHEDULED |

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|-------------|----------|
| `order_id` | number | ‚úÖ | ID –∑–∞–∫–∞–∑–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã |
| `halyk_card_id` | string | ‚úÖ | –ö–æ–¥ –∫–∞—Ä—Ç—ã Halyk Bank |
| `backLink` | string | ‚ùå | –°—Å—ã–ª–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–∏ —É—Å–ø–µ—Ö–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: chorenn.naliv.kz/success) |
| `failureBackLink` | string | ‚ùå | –°—Å—ã–ª–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–∏ –æ—à–∏–±–∫–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: chorenn.naliv.kz/failure) |
| `postLink` | string | ‚ùå | Webhook URL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: chorenn.naliv.kz/api/payment.php) |

## –ü—Ä–∏–º–µ—Ä —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞

```bash
curl -X POST http://localhost:3000/api/orders/create-user-order \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -d '{
    "business_id": 2,
    "halyk_id": "abc123def456",
    "street": "—É–ª. –ü—É—à–∫–∏–Ω–∞",
    "house": "10",
    "apartment": "15",
    "lat": 52.271643,
    "lon": 76.950011,
    "items": [
      {
        "item_id": 100,
        "amount": 2
      }
    ],
    "delivery_type": "DELIVERY",
    "scheduled_delivery": {
      "type": "ASAP"
    }
  }'
```

## –ü—Ä–∏–º–µ—Ä –æ–ø–ª–∞—Ç—ã –ø–æ –∫–æ–¥—É –∫–∞—Ä—Ç—ã

```bash
curl -X POST http://localhost:3000/api/payments/pay-with-halyk-card \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -d '{
    "order_id": 12345,
    "halyk_card_id": "abc123def456"
  }'
```

## –û—Ç–≤–µ—Ç—ã

### –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ (201 Created)

```json
{
  "success": true,
  "data": {
    "order_id": 12345,
    "order_uuid": "1722763234252001",
    "total_cost": 2500.50,
    "status": "PAYMENT_INITIATED",
    "payment_info": {
      "halyk_id": "abc123def456",
      "auto_payment": true,
      "message": "–ü–ª–∞—Ç–µ–∂ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω"
    }
  },
  "message": "–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω –∏ –æ–ø–ª–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞"
}
```

### –£—Å–ø–µ—à–Ω–∞—è –∏–Ω–∏—Ü–∏–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã (200 OK)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Ñ–æ—Ä–º—ã Halyk Bank:

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Payment with Halyk Card</title>
    <script src="https://epay.homebank.kz/payform/payment-api.js"></script>
</head>
<body>
    <div class="payment-container">
        <h2>–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ –ø–æ –∫–æ–¥—É –∫–∞—Ä—Ç—ã Halyk</h2>
        <div class="order-info">
            <p><strong>–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:</strong> 1722763234252001</p>
            <p><strong>–°—É–º–º–∞ –∫ –æ–ø–ª–∞—Ç–µ:</strong> 2500.50 ‚Ç∏</p>
        </div>
        <div class="card-info">
            <p><strong>ID –∫–∞—Ä—Ç—ã Halyk:</strong> abc123def456</p>
            <p><strong>–¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞:</strong> –û–ø–ª–∞—Ç–∞ –ø–æ –∫–æ–¥—É –∫–∞—Ä—Ç—ã Halyk</p>
        </div>
    </div>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞ —Å –∫–æ–¥–æ–º –∫–∞—Ä—Ç—ã Halyk
        halyk.pay(createPaymentObject(authToken, invoiceId, amount, halykCardId));
    </script>
</body>
</html>
```

### –û—à–∏–±–∫–∏

#### –ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω (404)
```json
{
  "success": false,
  "error": {
    "message": "–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω",
    "statusCode": 404,
    "timestamp": "2025-08-04T11:43:22.123Z"
  }
}
```

#### –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (400)
```json
{
  "success": false,
  "error": {
    "message": "–ù–µ —É–∫–∞–∑–∞–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: order_id, halyk_card_id",
    "statusCode": 400,
    "timestamp": "2025-08-04T11:43:22.123Z"
  }
}
```

#### –ó–∞–∫–∞–∑ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω (400)
```json
{
  "success": false,
  "error": {
    "message": "–ó–∞–∫–∞–∑ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω",
    "statusCode": 400,
    "timestamp": "2025-08-04T11:43:22.123Z"
  }
}
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Halyk Bank API

```json
{
  "amount": "250050",
  "currency": "KZT",
  "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  "terminalId": "bb4dec49-6e30-41d0-b16b-8ba1831a854b",
  "invoiceId": "1722763234252001",
  "description": "–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞ ‚Ññ1722763234252001",
  "accountId": "252",
  "terminal": "bb4dec49-6e30-41d0-b16b-8ba1831a854b",
  "backLink": "https://chorenn.naliv.kz/success",
  "failureBackLink": "https://chorenn.naliv.kz/failure",
  "postLink": "https://chorenn.naliv.kz/api/payment.php",
  "language": "rus",
  "cardSave": false,
  "paymentType": "payment",
  "cardId": "abc123def456"
}
```

## –û—Ç–ª–∏—á–∏—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è | –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è |
|----------|---------------|--------------|
| **–ü–∞—Ä–∞–º–µ—Ç—Ä –∫–∞—Ä—Ç—ã** | `saved_card_id` (number) | `halyk_card_id` (string) |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –ë–î** | ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–ª–∞—Å—å —Ç–∞–±–ª–∏—Ü–∞ `halyk_saved_cards` | ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –ë–î |
| **–ú–∞—Ä—à—Ä—É—Ç** | `/pay-with-saved-card` | `/pay-with-halyk-card` |
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | –¢–æ–ª—å–∫–æ Halyk Bank API |
| **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞—Ä—Ç–µ** | –ú–∞—Å–∫–∞ –∫–∞—Ä—Ç—ã –∏–∑ –ë–î | –¢–æ–ª—å–∫–æ ID –∫–∞—Ä—Ç—ã |

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

- üöÄ **–ë—ã—Å—Ç—Ä–µ–µ** - –Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- üîß **–ü—Ä–æ—â–µ** - –º–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π 
- üéØ **–ù–∞–¥–µ–∂–Ω–µ–µ** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å Halyk Bank
- üîÑ **–ê–∫—Ç—É–∞–ª—å–Ω–µ–µ** - –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `test-halyk-card-payment.html` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ API:

```bash
open http://localhost:3000/test-halyk-card-payment.html
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: API –ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–æ–¥–∞ –∫–∞—Ä—Ç—ã Halyk Bank API. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:

1. –ö–æ–¥ –∫–∞—Ä—Ç—ã –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. JWT —Ç–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç –∫–æ—Ä–æ—Ç–∫–∏–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
4. –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –¥–ª—è –∞—É–¥–∏—Ç–∞

## –ú–∏–≥—Ä–∞—Ü–∏—è

–î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é:

1. –û–±–Ω–æ–≤–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `halyk_card_id` –≤–º–µ—Å—Ç–æ `saved_card_id`
2. –ò–∑–º–µ–Ω–∏—Ç–µ –º–∞—Ä—à—Ä—É—Ç —Å `/pay-with-saved-card` –Ω–∞ `/pay-with-halyk-card`
3. –ê–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—Ç–≤–µ—Ç–æ–≤ (–±–æ–ª—å—à–µ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–∞—Å–∫–µ –∫–∞—Ä—Ç—ã)
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã
