# üè† API –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ - –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –û–±–∑–æ—Ä —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

–°–∏—Å—Ç–µ–º–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å–≤–æ–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –±—ã—Å—Ç—Ä–æ –µ–≥–æ –ø–æ–ª—É—á–∞—Ç—å –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤.

## –ù–æ–≤—ã–µ endpoint'—ã

### 1. –ü–æ–ª—É—á–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å
```
GET /api/addresses/user/selected?business_id=1
```

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏.

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "success": true,
  "data": {
    "selected_address": {
      "address_id": 123,
      "lat": 52.2854,
      "lon": 76.9701,
      "address": "—É–ª. –ü–∞—Ö–æ–º–æ–≤–∞, 72",
      "name": "–î–æ–º",
      "apartment": "15",
      "entrance": "1",
      "floor": "3",
      "other": "–î–æ–º–æ—Ñ–æ–Ω 15",
      "city_id": 1,
      "created_at": "2024-01-15T10:30:00.000Z",
      "selected_at": "2024-01-16T14:20:00.000Z",
      "delivery": {
        "available": true,
        "price": 500,
        "delivery_type": "standard",
        "message": "–î–æ—Å—Ç–∞–≤–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞",
        "distance": 3.2
      }
    },
    "business_id": 1
  },
  "message": "–í—ã–±—Ä–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å –Ω–∞–π–¥–µ–Ω —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –¥–æ—Å—Ç–∞–≤–∫–µ"
}
```

**–û—Ç–≤–µ—Ç (–∞–¥—Ä–µ—Å –Ω–µ –≤—ã–±—Ä–∞–Ω):**
```json
{
  "success": false,
  "error": {
    "message": "–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞",
    "statusCode": 404
  }
}
```

### 2. –í—ã–±—Ä–∞—Ç—å –∞–¥—Ä–µ—Å
```
POST /api/addresses/user/select
```

**Body:**
```json
{
  "address_id": 123
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "selected_address_id": 456,
    "address_id": 123,
    "user_id": 789,
    "selected_at": "2024-01-16T14:20:00.000Z"
  },
  "message": "–ê–¥—Ä–µ—Å —É—Å–ø–µ—à–Ω–æ –≤—ã–±—Ä–∞–Ω"
}
```

## –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–¢–∞–±–ª–∏—Ü–∞ `selected_address`:
```sql
CREATE TABLE selected_address (
  relation_id INT PRIMARY KEY AUTO_INCREMENT,
  address_id INT NOT NULL,
  user_id INT NOT NULL,
  log_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞:** –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∞–¥—Ä–µ—Å, —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ `selected_address`
2. **–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å (ORDER BY log_timestamp DESC)
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### React Hook
```javascript
const useSelectedAddress = (businessId = null) => {
  const [selectedAddress, setSelectedAddress] = useState(null);
  
  const loadSelectedAddress = async () => {
    const response = await fetch('/api/addresses/user/selected?business_id=' + businessId);
    if (response.ok) {
      const data = await response.json();
      setSelectedAddress(data.data.selected_address);
    }
  };
  
  return { selectedAddress, loadSelectedAddress };
};
```

### –í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞
```javascript
const selectAddress = async (addressId) => {
  const response = await fetch('/api/addresses/user/select', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ address_id: addressId })
  });
  
  if (response.ok) {
    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –∞–¥—Ä–µ—Å
    await loadSelectedAddress();
  }
};
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏ (5 –º–∏–Ω—É—Ç TTL)
- ‚úÖ –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ user_id –≤ selected_address
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∞–¥—Ä–µ—Å–æ–≤ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (JWT token)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `test-selected-address.html` –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö endpoint'–æ–≤.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```
‚ö° –ó–∞–ø—Ä–æ—Å –∞–¥—Ä–µ—Å–æ–≤ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –≤—ã–ø–æ–ª–Ω–µ–Ω –∑–∞ 250–º—Å
```
