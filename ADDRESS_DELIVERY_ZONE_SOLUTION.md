# ðŸš« Ð ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ "ÐÐ´Ñ€ÐµÑ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ð¼Ð¸ Ð·Ð¾Ð½Ñ‹ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸"

## ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹

ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÑŽÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ:
```json
{
    "error": {
        "message": "Ð”Ð¾ÑÑ‚Ð°Ð²ÐºÐ° Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°: ÐÐ´Ñ€ÐµÑ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ð¼Ð¸ Ð·Ð¾Ð½Ñ‹ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸",
        "statusCode": 400,
        "timestamp": "2025-07-30T04:46:23.733Z",
        "path": "/api/orders/create-user-order",
        "method": "POST"
    }
}
```

## ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ñ‹ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ½Ð¾Ð²ÐµÐ½Ð¸Ñ

### 1. Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ Ð² Ð´Ñ€ÑƒÐ³Ð¾Ð¼ Ð³Ð¾Ñ€Ð¾Ð´Ðµ
ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð²Ñ‹Ð±Ñ€Ð°Ð» Ð°Ð´Ñ€ÐµÑ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ Ð² Ð¾Ð´Ð½Ð¾Ð¼ Ð³Ð¾Ñ€Ð¾Ð´Ðµ, Ð½Ð¾ Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ Ð·Ð°ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¸Ð· Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð° Ð² Ð´Ñ€ÑƒÐ³Ð¾Ð¼ Ð³Ð¾Ñ€Ð¾Ð´Ðµ.

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
- ÐœÐ°Ð³Ð°Ð·Ð¸Ð½: ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€ (business_id: 1)
- Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ: ÐšÐ°Ñ€Ð°Ð³Ð°Ð½Ð´Ð° (address_id: 62655)

### 2. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð²Ñ‹Ð±Ð¾Ñ€ Ð½ÐµÐ¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰ÐµÐ³Ð¾ Ð°Ð´Ñ€ÐµÑÐ°
Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ð¸Ð»Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¼Ð¾Ð¶ÐµÑ‚ Ð½Ðµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ð´Ð»Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°.

## Ð ÐµÑˆÐµÐ½Ð¸Ñ

### âœ… Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ address_id
ÐŸÑ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð·Ð°ÐºÐ°Ð·Ð° Ð¿ÐµÑ€ÐµÐ´Ð°Ð²Ð°Ð¹Ñ‚Ðµ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ `address_id`:

```json
{
  "business_id": 1,
  "items": [...],
  "delivery": true,
  "address_id": 60466
}
```

### âœ… Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: Ð’Ñ‹Ð±Ð¾Ñ€ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð°Ð´Ñ€ÐµÑÐ° Ñ‡ÐµÑ€ÐµÐ· API
Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð°Ð´Ñ€ÐµÑ Ð² Ñ‚Ð¾Ð¼ Ð¶Ðµ Ð³Ð¾Ñ€Ð¾Ð´Ðµ, Ñ‡Ñ‚Ð¾ Ð¸ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½:

```bash
curl -X POST "http://localhost:3000/api/addresses/user/select" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"address_id": 60466}'
```

### âœ… Ð ÐµÑˆÐµÐ½Ð¸Ðµ 3: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð¾Ð½Ñ‹ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ´ Ð·Ð°ÐºÐ°Ð·Ð¾Ð¼
ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸:

```bash
curl -X POST "http://localhost:3000/api/addresses/check-delivery" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "lat": 52.289902,
    "lon": 76.954619,
    "business_id": 1
  }'
```

## ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹

### Ð”Ð¾ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ:
1. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð±Ñ€Ð°Ð»Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ
2. ÐÐµ ÑƒÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°Ð»Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ Ð¸Ð· `selected_address`
3. ÐÐµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐ»Ð° Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‚ÑŒ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ `address_id`

### ÐŸÐ¾ÑÐ»Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ:
1. âœ… ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚ `address_id` Ð¸Ð· Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
2. âœ… Ð—Ð°Ñ‚ÐµÐ¼ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ Ð¸Ð· `selected_address`
3. âœ… Ð’ ÐºÑ€Ð°Ð¹Ð½ÐµÐ¼ ÑÐ»ÑƒÑ‡Ð°Ðµ - Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ

## ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð°Ð´Ñ€ÐµÑÐ¾Ð² Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ

### SQL Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð°Ð´Ñ€ÐµÑÐ¾Ð²:
```sql
SELECT 
  ua.address_id,
  ua.address,
  ua.lat,
  ua.lon,
  CASE 
    WHEN ua.lat BETWEEN 52.0 AND 53.0 AND ua.lon BETWEEN 76.0 AND 77.0 THEN 'ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€'
    WHEN ua.lat BETWEEN 49.0 AND 50.0 AND ua.lon BETWEEN 73.0 AND 74.0 THEN 'ÐšÐ°Ñ€Ð°Ð³Ð°Ð½Ð´Ð°'
    ELSE 'Ð”Ñ€ÑƒÐ³Ð¾Ð¹ Ð³Ð¾Ñ€Ð¾Ð´'
  END as city_guess,
  ST_Contains(c.city_border, ST_PointFromText(CONCAT('POINT(', ua.lon, ' ', ua.lat, ')'))) as in_pavlodar
FROM user_addreses ua
CROSS JOIN cities c
WHERE ua.user_id = 252 
  AND ua.isDeleted = 0 
  AND c.city_id = 1
ORDER BY ua.address_id DESC;
```

## Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ñ„Ñ€Ð¾Ð½Ñ‚ÐµÐ½Ð´Ð°

### 1. ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ Ð³Ð¾Ñ€Ð¾Ð´ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ð°
```javascript
const businessInfo = await fetch(`/api/businesses/${business_id}`);
console.log(`Ð—Ð°ÐºÐ°Ð· Ð¸Ð· Ð³Ð¾Ñ€Ð¾Ð´Ð°: ${businessInfo.city_name}`);
```

### 2. Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð°Ð´Ñ€ÐµÑÐ° Ð¿Ð¾ Ð³Ð¾Ñ€Ð¾Ð´Ñƒ
```javascript
const suitableAddresses = userAddresses.filter(addr => {
  // ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ, Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð»Ð¸ Ð°Ð´Ñ€ÐµÑ Ð´Ð»Ñ Ð´Ð°Ð½Ð½Ð¾Ð³Ð¾ business_id
  return addr.city === business.city;
});
```

### 3. ÐŸÑ€ÐµÐ´ÑƒÐ¿Ñ€ÐµÐ¶Ð´Ð°Ñ‚ÑŒ Ð¾ Ð½ÐµÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚Ð¸
```javascript
if (selectedAddress.city !== business.city) {
  showWarning('Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð² Ð´Ñ€ÑƒÐ³Ð¾Ð¼ Ð³Ð¾Ñ€Ð¾Ð´Ðµ');
}
```

## ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²

### Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð° Ñ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¼ Ð°Ð´Ñ€ÐµÑÐ¾Ð¼:
```json
{
  "business_id": 1,
  "items": [
    {
      "item_id": 25754,
      "amount": 1
    }
  ],
  "delivery": true,
  "address_id": 60466,
  "extra": "Ð”Ð¾Ð¼Ð¾Ñ„Ð¾Ð½ 15"
}
```

### Ð’Ñ‹Ð±Ð¾Ñ€ Ð¿Ð¾Ð´Ñ…Ð¾Ð´ÑÑ‰ÐµÐ³Ð¾ Ð°Ð´Ñ€ÐµÑÐ°:
```json
{
  "address_id": 60466
}
```

## ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð»Ð¾Ð³Ð¸ Ð´Ð»Ñ Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸:
- Ð’Ñ‹Ð±Ð¾Ñ€ Ð°Ð´Ñ€ÐµÑÐ°: ÐºÐ°ÐºÐ¾Ð¹ Ð°Ð´Ñ€ÐµÑ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð¾Ð½Ñ‹: Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸
- ÐžÑˆÐ¸Ð±ÐºÐ¸: Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ðµ Ð¾Ñ‚ÐºÐ°Ð·Ð°

```
ðŸ“ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð°Ð´Ñ€ÐµÑ: 60466 (ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€)
âœ… ÐÐ´Ñ€ÐµÑ Ð² Ð·Ð¾Ð½Ðµ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸, Ñ†ÐµÐ½Ð°: 500 Ñ‚ÐµÐ½Ð³Ðµ
âŒ ÐÐ´Ñ€ÐµÑ Ð·Ð° Ð¿Ñ€ÐµÐ´ÐµÐ»Ð°Ð¼Ð¸ Ð·Ð¾Ð½Ñ‹ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸: ÐšÐ°Ñ€Ð°Ð³Ð°Ð½Ð´Ð° -> ÐŸÐ°Ð²Ð»Ð¾Ð´Ð°Ñ€
```
