# üìç –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Address Controller

## –û–±–∑–æ—Ä

**AddressController** —É–ø—Ä–∞–≤–ª—è–µ—Ç –∞–¥—Ä–µ—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–∏—Å–∫–∞ —á–µ—Ä–µ–∑ geocoding API (Nominatim).

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/controllers/addressController.ts`  
**–ú–∞—Ä—à—Ä—É—Ç—ã:** `src/routes/addresses.ts`

---

## üõ£Ô∏è –ú–∞—Ä—à—Ä—É—Ç—ã –∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | `/api/addresses/search` | –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤ —á–µ—Ä–µ–∑ Nominatim Geocoding API |
| GET | `/api/addresses/reverse` | –û–±—Ä–∞—Ç–Ω—ã–π –≥–µ–æ–∫–æ–¥–∏–Ω–≥ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Üí –∞–¥—Ä–µ—Å) |

### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (—Ç—Ä–µ–±—É–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω):

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | `/api/addresses` | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–¥—Ä–µ—Å–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| GET | `/api/addresses/:id` | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –ø–æ ID |
| POST | `/api/addresses` | –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å |
| PUT | `/api/addresses/:id` | –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–¥—Ä–µ—Å |
| DELETE | `/api/addresses/:id` | –£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å |

---

## üìã –ú–µ—Ç–æ–¥—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞

### 1. `searchAddresses` - –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/addresses/search`

–ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤ —á–µ—Ä–µ–∑ Nominatim Geocoding API —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ mock –¥–∞–Ω–Ω—ã–µ.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
- `query` (string, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - —Å—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞ –∞–¥—Ä–µ—Å–∞

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl "http://localhost:3000/api/addresses/search?query=–ø–∞–≤–ª–æ–¥–∞—Ä+–ø–∞—Ö–æ–º–æ–≤–∞+72"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (—É—Å–ø–µ—Ö):
```json
{
  "success": true,
  "data": {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {
          "name": "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –ü–∞–≤–ª–æ–¥–∞—Ä, —É–ª–∏—Ü–∞ –ü–∞—Ö–æ–º–æ–≤–∞, 72",
          "geocoding": {
            "label": "—É–ª–∏—Ü–∞ –ü–∞—Ö–æ–º–æ–≤–∞, 72",
            "type": "house"
          }
        },
        "geometry": {
          "type": "Point",
          "coordinates": [76.9701, 52.2854]
        }
      }
    ]
  }
}
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Nominatim API: `https://geocode.naliv.kz/search.php`
- ‚úÖ –¢–∞–π–º–∞—É—Ç: 2 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞: GeoJSON
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Accept-Language: ru`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ mock –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—é—Ç: –ú–æ—Å–∫–≤–∞, –ê–ª–º–∞—Ç—ã, –ü–∞–≤–ª–æ–¥–∞—Ä, –ê—Å—Ç–∞–Ω–∞/–ù—É—Ä-–°—É–ª—Ç–∞–Ω, —É–ª–∏—Ü—É –ü—É—à–∫–∏–Ω–∞

#### –û—à–∏–±–∫–∏:
- `400` - –ü–∞—Ä–∞–º–µ—Ç—Ä query –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
- `500` - –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –∞–¥—Ä–µ—Å–æ–≤

---

### 2. `reverseGeocode` - –û–±—Ä–∞—Ç–Ω—ã–π –≥–µ–æ–∫–æ–¥–∏–Ω–≥

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/addresses/reverse`

–ü–æ–ª—É—á–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º.

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:
- `lat` (number, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - —à–∏—Ä–æ—Ç–∞
- `lon` (number, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - –¥–æ–ª–≥–æ—Ç–∞

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl "http://localhost:3000/api/addresses/reverse?lat=52.285446&lon=76.970107"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "success": true,
  "data": {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {
          "name": "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –ü–∞–≤–ª–æ–¥–∞—Ä",
          "geocoding": {
            "label": "–ü–∞–≤–ª–æ–¥–∞—Ä",
            "type": "city"
          }
        },
        "geometry": {
          "type": "Point",
          "coordinates": [76.970107, 52.285446]
        }
      }
    ]
  },
  "message": "–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º"
}
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Nominatim reverse geocoding: `https://geocode.naliv.kz/reverse.php`
- ‚úÖ –¢–∞–π–º–∞—É—Ç: 2 —Å–µ–∫—É–Ω–¥—ã
- ‚úÖ –§–æ—Ä–º–∞—Ç: GeoJSON —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∞–¥—Ä–µ—Å–µ

#### –û—à–∏–±–∫–∏:
- `400` - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã lat –∏ lon –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏
- `500` - –û—à–∏–±–∫–∞ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è

---

### 3. `getUserAddresses` - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/addresses`  
**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** Bearer Token (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∞–¥—Ä–µ—Å–∞ —Ç–µ–∫—É—â–µ–≥–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### Headers:
```
Authorization: Bearer YOUR_JWT_TOKEN
```

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X GET "http://localhost:3000/api/addresses" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "success": true,
  "data": [
    {
      "address_id": 1,
      "user_id": 158,
      "name": "–î–æ–º",
      "address": "—É–ª. –ü—É—à–∫–∏–Ω–∞, 12",
      "lat": 43.2220,
      "lon": 76.8512,
      "apartment": "25",
      "entrance": "2",
      "floor": "5",
      "other": "–ö–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ 123",
      "city_id": null,
      "log_timestamp": "2025-07-24T13:30:00.000Z",
      "isDeleted": 0
    }
  ],
  "message": "–ê–¥—Ä–µ—Å–∞ –ø–æ–ª—É—á–µ–Ω—ã"
}
```

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é `address_id` (–Ω–æ–≤—ã–µ –∞–¥—Ä–µ—Å–∞ –ø–µ—Ä–≤—ã–º–∏)
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–¥—Ä–µ—Å–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è –∞–¥—Ä–µ—Å–∞

#### –û—à–∏–±–∫–∏:
- `401` - –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `500` - –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤

---

### 4. `getAddress` - –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∞–¥—Ä–µ—Å

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/addresses/:id`  
**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** Bearer Token (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∞–¥—Ä–µ—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `id` (number, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - ID –∞–¥—Ä–µ—Å–∞

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X GET "http://localhost:3000/api/addresses/1" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "success": true,
  "data": {
    "address_id": 1,
    "user_id": 158,
    "name": "–î–æ–º",
    "address": "—É–ª. –ü—É—à–∫–∏–Ω–∞, 12",
    "lat": 43.2220,
    "lon": 76.8512,
    "apartment": "25",
    "entrance": "2",
    "floor": "5",
    "other": "–ö–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ 123",
    "city_id": null,
    "log_timestamp": "2025-07-24T13:30:00.000Z",
    "isDeleted": 0
  },
  "message": "–ê–¥—Ä–µ—Å –ø–æ–ª—É—á–µ–Ω"
}
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ ID –∞–¥—Ä–µ—Å–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

#### –û—à–∏–±–∫–∏:
- `400` - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∞–¥—Ä–µ—Å–∞
- `401` - –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `404` - –ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `500` - –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞

---

### 5. `addAddress` - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/addresses`  
**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** Bearer Token (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### Headers:
```
Authorization: Bearer YOUR_JWT_TOKEN
Content-Type: application/json
```

#### Body –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ | –û–ø–∏—Å–∞–Ω–∏–µ | –í–∞–ª–∏–¥–∞—Ü–∏—è |
|------|-----|-------------|----------|-----------|
| `name` | string | ‚úÖ | –ù–∞–∑–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–î–æ–º", "–†–∞–±–æ—Ç–∞") | –ù–µ –ø—É—Å—Ç–æ–µ |
| `address` | string | ‚úÖ | –ü–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å | –ù–µ –ø—É—Å—Ç–æ–µ |
| `lat` | number | ‚úÖ | –®–∏—Ä–æ—Ç–∞ | -90 –¥–æ 90 |
| `lon` | number | ‚úÖ | –î–æ–ª–≥–æ—Ç–∞ | -180 –¥–æ 180 |
| `apartment` | string | ‚ùå | –ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã | - |
| `entrance` | string | ‚ùå | –ù–æ–º–µ—Ä –ø–æ–¥—ä–µ–∑–¥–∞ | - |
| `floor` | string | ‚ùå | –≠—Ç–∞–∂ | - |
| `other` | string | ‚ùå | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–∫–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ –∏ —Ç.–¥.) | - |

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X POST "http://localhost:3000/api/addresses" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–î–æ–º",
    "address": "—É–ª. –ü—É—à–∫–∏–Ω–∞, 12, –ê–ª–º–∞—Ç—ã",
    "lat": 43.2220,
    "lon": 76.8512,
    "apartment": "25",
    "entrance": "2",
    "floor": "5",
    "other": "–ö–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ 123"
  }'
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (—É—Å–ø–µ—Ö):
```json
{
  "success": true,
  "data": {
    "address_id": 60786,
    "user_id": 158,
    "name": "–î–æ–º",
    "address": "—É–ª. –ü—É—à–∫–∏–Ω–∞, 12, –ê–ª–º–∞—Ç—ã",
    "lat": 43.2220,
    "lon": 76.8512,
    "apartment": "25",
    "entrance": "2",
    "floor": "5",
    "other": "–ö–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ 123",
    "city_id": null,
    "log_timestamp": "2025-07-24T13:28:27.000Z",
    "isDeleted": 0
  },
  "message": "–ê–¥—Ä–µ—Å —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω"
}
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (name, address, lat, lon)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª—è—Ö
- ‚úÖ –ü—É—Å—Ç—ã–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–∞–∫ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏

#### –û—à–∏–±–∫–∏:
- `400` - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: name, address, lat, lon
- `400` - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏
- `400` - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- `401` - –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `500` - –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞

---

### 6. `updateAddress` - –û–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `PUT /api/addresses/:id`  
**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** Bearer Token (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.

#### URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `id` (number, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - ID –∞–¥—Ä–µ—Å–∞

#### Headers:
```
Authorization: Bearer YOUR_JWT_TOKEN
Content-Type: application/json
```

#### Body –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–≤—Å–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã):
- `name` (string) - –ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
- `address` (string) - –ù–æ–≤—ã–π –∞–¥—Ä–µ—Å
- `lat` (number) - –ù–æ–≤–∞—è —à–∏—Ä–æ—Ç–∞
- `lon` (number) - –ù–æ–≤–∞—è –¥–æ–ª–≥–æ—Ç–∞
- `apartment` (string) - –ù–æ–≤—ã–π –Ω–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã
- `entrance` (string) - –ù–æ–≤—ã–π –Ω–æ–º–µ—Ä –ø–æ–¥—ä–µ–∑–¥–∞
- `floor` (string) - –ù–æ–≤—ã–π —ç—Ç–∞–∂
- `other` (string) - –ù–æ–≤–∞—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X PUT "http://localhost:3000/api/addresses/1" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "apartment": "26",
    "other": "–ù–æ–≤—ã–π –∫–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ 456"
  }'
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:
```json
{
  "success": true,
  "data": {
    "address_id": 1,
    "user_id": 158,
    "name": "–î–æ–º",
    "address": "—É–ª. –ü—É—à–∫–∏–Ω–∞, 12",
    "lat": 43.2220,
    "lon": 76.8512,
    "apartment": "26",
    "entrance": "2",
    "floor": "5",
    "other": "–ù–æ–≤—ã–π –∫–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ 456",
    "city_id": null,
    "log_timestamp": "2025-07-24T13:30:00.000Z",
    "isDeleted": 0
  },
  "message": "–ê–¥—Ä–µ—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω"
}
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ ID –∞–¥—Ä–µ—Å–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è
- ‚úÖ –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (–æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–µ–∑–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª—è—Ö

#### –û—à–∏–±–∫–∏:
- `400` - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∞–¥—Ä–µ—Å–∞
- `400` - –ù–∞–∑–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º
- `400` - –ê–¥—Ä–µ—Å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º
- `400` - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —à–∏—Ä–æ—Ç–∞/–¥–æ–ª–≥–æ—Ç–∞
- `401` - –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `404` - –ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `500` - –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞

---

### 7. `deleteAddress` - –£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `DELETE /api/addresses/:id`  
**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:** Bearer Token (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

–£–¥–∞–ª—è–µ—Ç –∞–¥—Ä–µ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. **–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∑–∞–∫–∞–∑–∞—Ö.**

#### URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `id` (number, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) - ID –∞–¥—Ä–µ—Å–∞

#### Headers:
```
Authorization: Bearer YOUR_JWT_TOKEN
```

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X DELETE "http://localhost:3000/api/addresses/1" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (—É—Å–ø–µ—Ö):
```json
{
  "success": true,
  "data": {
    "address_id": 1
  },
  "message": "–ê–¥—Ä–µ—Å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω"
}
```

#### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ ID –∞–¥—Ä–µ—Å–∞
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∑–∞–∫–∞–∑–∞—Ö** (–∑–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤)

#### –û—à–∏–±–∫–∏:
- `400` - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∞–¥—Ä–µ—Å–∞
- `400` - **–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –∑–∞–∫–∞–∑–∞—Ö**
- `401` - –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `404` - –ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `500` - –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
- ‚úÖ –í—Å–µ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ (GET/POST/PUT/DELETE) —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å **—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ –∞–¥—Ä–µ—Å–∞–º–∏**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∞–¥—Ä–µ—Å–∞ –ø—Ä–∏ GET/PUT/DELETE –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –Ω–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –∫ `user_id` –∏–∑ —Ç–æ–∫–µ–Ω–∞

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
- ‚úÖ **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:** lat (-90..90), lon (-180..180)
- ‚úÖ **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:** –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
- ‚úÖ **–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:** –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è:** –∞–¥—Ä–µ—Å–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ –∑–∞–∫–∞–∑–∞—Ö, –∑–∞—â–∏—â–µ–Ω—ã

### –ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫:
- ‚úÖ –û–±—Ä–µ–∑–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª—è—Ö (trim)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è ID –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: `user_addreses`

```sql
CREATE TABLE user_addreses (
  address_id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  name VARCHAR(255) NOT NULL,
  address VARCHAR(255) NOT NULL,
  lat FLOAT NOT NULL,
  lon FLOAT NOT NULL,
  apartment VARCHAR(20) DEFAULT '',
  entrance VARCHAR(20) DEFAULT '',
  floor VARCHAR(20) DEFAULT '',
  other VARCHAR(255) DEFAULT '',
  city_id INT,
  log_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  isDeleted INT DEFAULT 0,
  
  INDEX idx_user_id (user_id),
  INDEX idx_address_id (address_id)
);
```

### –°–≤—è–∑–∏:
- `user_id` ‚Üí `users.user_id`
- `address_id` ‚Üí `orders.address_id` (–∑–∞—â–∏—Ç–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏)

---

## üåç –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Nominatim Geocoding API

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- **API Endpoint (Search):** `https://geocode.naliv.kz/search.php`
- **API Endpoint (Reverse):** `https://geocode.naliv.kz/reverse.php`
- **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞:** GeoJSON
- **–Ø–∑—ã–∫:** –†—É—Å—Å–∫–∏–π (`Accept-Language: ru`)
- **–¢–∞–π–º–∞—É—Ç:** 2000 –º—Å

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞:
```javascript
{
  q: query,                 // –°—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞
  addressdetails: '1',      // –î–µ—Ç–∞–ª–∏ –∞–¥—Ä–µ—Å–∞
  namedetails: '1',         // –î–µ—Ç–∞–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–π
  format: 'geocodejson'     // –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
}
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã reverse geocoding:
```javascript
{
  lat: latitude,
  lon: longitude,
  format: 'geocodejson',
  addressdetails: '1',
  namedetails: '1'
}
```

### Fallback –º–µ—Ö–∞–Ω–∏–∑–º:
–ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Nominatim API –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤:
- –ú–æ—Å–∫–≤–∞
- –ê–ª–º–∞—Ç—ã
- –ü–∞–≤–ª–æ–¥–∞—Ä (—Å —É–ª–∏—Ü–µ–π –ü–∞—Ö–æ–º–æ–≤–∞)
- –ê—Å—Ç–∞–Ω–∞/–ù—É—Ä-–°—É–ª—Ç–∞–Ω
- –£–ª–∏—Ü–∞ –ü—É—à–∫–∏–Ω–∞ (–ú–æ—Å–∫–≤–∞)

---

## üîÑ –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏

```bash
# –®–∞–≥ 1: –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞
curl "http://localhost:3000/api/addresses/search?query=–ø–∞–≤–ª–æ–¥–∞—Ä+–ø—É—à–∫–∏–Ω–∞+12"

# –®–∞–≥ 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –∞–¥—Ä–µ—Å –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
# –®–∞–≥ 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞
curl -X POST "http://localhost:3000/api/addresses" \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–î–æ–º",
    "address": "—É–ª. –ü—É—à–∫–∏–Ω–∞, 12, –ü–∞–≤–ª–æ–¥–∞—Ä",
    "lat": 52.2854,
    "lon": 76.9701,
    "apartment": "15",
    "other": "–ö–æ–¥ 1234"
  }'
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –í—ã–±–æ—Ä –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞

```bash
# –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X GET "http://localhost:3000/api/addresses" \
  -H "Authorization: Bearer TOKEN"

# –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å address_id –≤ –∑–∞–∫–∞–∑–µ
curl -X POST "http://localhost:3000/api/orders/create-user-order" \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "business_id": 1,
    "address_id": 1,
    "delivery_type": "DELIVERY",
    "items": [...]
  }'
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –∞–¥—Ä–µ—Å–∞

```bash
# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∏—Ä—ã –∏ –∫–æ–¥–∞ –¥–æ–º–æ—Ñ–æ–Ω–∞
curl -X PUT "http://localhost:3000/api/addresses/1" \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "apartment": "16",
    "other": "–ù–æ–≤—ã–π –∫–æ–¥ 5678"
  }'
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û–±—Ä–∞—Ç–Ω—ã–π –≥–µ–æ–∫–æ–¥–∏–Ω–≥ (–º–µ—Ç–∫–∞ –Ω–∞ –∫–∞—Ä—Ç–µ ‚Üí –∞–¥—Ä–µ—Å)

```bash
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ—Å—Ç–∞–≤–∏–ª –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ
curl "http://localhost:3000/api/addresses/reverse?lat=52.285446&lon=76.970107"

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
```

---

## ‚ö†Ô∏è –ö–æ–¥—ã –æ—à–∏–±–æ–∫ –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞

| –ö–æ–¥ | –°–æ–æ–±—â–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|-----|-----------|---------|---------|
| 400 | –ü–∞—Ä–∞–º–µ—Ç—Ä query –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç query –≤ search | –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä query |
| 400 | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: name, address, lat, lon | –ù–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ | –ü–µ—Ä–µ–¥–∞—Ç—å –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è |
| 400 | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å–ª–∞–º–∏ | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–∏–ø –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç | –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ number |
| 400 | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã | –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å lat (-90..90), lon (-180..180) |
| 400 | –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –∑–∞–∫–∞–∑–∞—Ö | –ê–¥—Ä–µ—Å —Å–≤—è–∑–∞–Ω —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∑–∞–∫–∞–∑–∞–º–∏ | –£–¥–∞–ª–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∞–¥—Ä–µ—Å–∞ |
| 400 | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∞–¥—Ä–µ—Å–∞ | ID –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–∏—Å–ª–æ–º –∏–ª–∏ –º–µ–Ω—å—à–µ 1 | –ü–µ—Ä–µ–¥–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —á–∏—Å–ª–æ–≤–æ–π ID |
| 401 | –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JWT —Ç–æ–∫–µ–Ω | –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ö–æ–¥ –∏ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω |
| 404 | –ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é | –ù–µ–≤–µ—Ä–Ω—ã–π ID –∏–ª–∏ –ø–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —á—É–∂–æ–º—É –∞–¥—Ä–µ—Å—É | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ID –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ |
| 500 | –û—à–∏–±–∫–∞... | –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞/–ë–î | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ |

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### React/JavaScript –ø—Ä–∏–º–µ—Ä:

```javascript
// –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–¥—Ä–µ—Å–∞–º–∏
class AddressService {
  constructor(token) {
    this.token = token;
    this.baseUrl = '/api/addresses';
  }

  // –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–æ–≤
  async search(query) {
    const response = await fetch(`${this.baseUrl}/search?query=${encodeURIComponent(query)}`);
    const data = await response.json();
    if (!data.success) throw new Error(data.error?.message);
    return data.data;
  }

  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–¥—Ä–µ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  async getAll() {
    const response = await fetch(this.baseUrl, {
      headers: { 'Authorization': `Bearer ${this.token}` }
    });
    const data = await response.json();
    if (!data.success) throw new Error(data.error?.message);
    return data.data;
  }

  // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∞–¥—Ä–µ—Å
  async add(addressData) {
    const response = await fetch(this.baseUrl, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${this.token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(addressData)
    });
    const data = await response.json();
    if (!data.success) throw new Error(data.error?.message);
    return data.data;
  }

  // –û–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å
  async update(id, updates) {
    const response = await fetch(`${this.baseUrl}/${id}`, {
      method: 'PUT',
      headers: {
        'Authorization': `Bearer ${this.token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(updates)
    });
    const data = await response.json();
    if (!data.success) throw new Error(data.error?.message);
    return data.data;
  }

  // –£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å
  async delete(id) {
    const response = await fetch(`${this.baseUrl}/${id}`, {
      method: 'DELETE',
      headers: { 'Authorization': `Bearer ${this.token}` }
    });
    const data = await response.json();
    if (!data.success) throw new Error(data.error?.message);
    return data.data;
  }

  // –û–±—Ä–∞—Ç–Ω—ã–π –≥–µ–æ–∫–æ–¥–∏–Ω–≥
  async reverseGeocode(lat, lon) {
    const response = await fetch(`${this.baseUrl}/reverse?lat=${lat}&lon=${lon}`);
    const data = await response.json();
    if (!data.success) throw new Error(data.error?.message);
    return data.data;
  }
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
const addressService = new AddressService(userToken);

// –ü–æ–∏—Å–∫ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–∞
const results = await addressService.search('–ø–∞–≤–ª–æ–¥–∞—Ä –ø—É—à–∫–∏–Ω–∞ 12');
const newAddress = await addressService.add({
  name: '–î–æ–º',
  address: results.features[0].properties.name,
  lat: results.features[0].geometry.coordinates[1],
  lon: results.features[0].geometry.coordinates[0],
  apartment: '15'
});
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å curl:

```bash
# 1. –ü–æ–ª—É—á–∏—Ç—å JWT —Ç–æ–∫–µ–Ω
TOKEN=$(curl -X POST "http://localhost:3000/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"phone": "+77077707600", "password": "password123"}' \
  | jq -r '.data.token')

# 2. –ü–æ–∏—Å–∫ –∞–¥—Ä–µ—Å–∞
curl "http://localhost:3000/api/addresses/search?query=–ø–∞–≤–ª–æ–¥–∞—Ä"

# 3. –î–æ–±–∞–≤–∏—Ç—å –∞–¥—Ä–µ—Å
curl -X POST "http://localhost:3000/api/addresses" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–¢–µ—Å—Ç–æ–≤—ã–π –∞–¥—Ä–µ—Å",
    "address": "—É–ª. –¢–µ—Å—Ç–æ–≤–∞—è, 1",
    "lat": 52.285,
    "lon": 76.970,
    "apartment": "100"
  }'

# 4. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–¥—Ä–µ—Å–∞
curl "http://localhost:3000/api/addresses" \
  -H "Authorization: Bearer $TOKEN"

# 5. –û–±–Ω–æ–≤–∏—Ç—å –∞–¥—Ä–µ—Å (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π ID)
curl -X PUT "http://localhost:3000/api/addresses/1" \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"apartment": "101"}'

# 6. –£–¥–∞–ª–∏—Ç—å –∞–¥—Ä–µ—Å
curl -X DELETE "http://localhost:3000/api/addresses/1" \
  -H "Authorization: Bearer $TOKEN"
```

---

## üìö –°–≤—è–∑–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [ADDRESSES_API.md](ADDRESSES_API.md) - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [API_DOCUMENTATION.md](API_DOCUMENTATION.md) - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤—Å–µ—Ö API
- [ORDER_API_DOCUMENTATION.md](ORDER_API_DOCUMENTATION.md) - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ –≤ –∑–∞–∫–∞–∑–∞—Ö

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- `@prisma/client` - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- `axios` - HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Nominatim API
- `express` - Web framework

### Middleware:
- `authenticateToken` - –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- `errorHandler` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–Ω–µ—à–Ω–µ–º—É API –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —ç–º–æ–¥–∑–∏ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è (üîç, üì°, ‚úÖ, ‚ùå)

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `user_id` –∏ `address_id` –≤ –ë–î
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API (2 —Å–µ–∫)
- ‚úÖ Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- ‚úÖ –ú–∏–Ω–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å debounce –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 1.0  
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 11 —è–Ω–≤–∞—Ä—è 2026  
**–ê–≤—Ç–æ—Ä:** Naliv Backend Team
