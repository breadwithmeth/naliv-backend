# üöÄ Firebase Admin SDK Integration - –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ

### 1. **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Firebase Admin SDK**
```bash
npm install firebase-admin
```

### 2. **–°–æ–∑–¥–∞–Ω FirebaseAdminService** (`src/services/firebaseAdmin.ts`)
- **Singleton pattern** –¥–ª—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** —Å Service Account
- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏:**
  - `sendNotification()` - –æ–¥–∏–Ω–æ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  - `sendToMultipleTokens()` - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
  - `validateToken()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
- **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** FCM
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Android –∏ iOS** —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

### 3. **–û–±–Ω–æ–≤–ª–µ–Ω NotificationController**
- **–ó–∞–º–µ–Ω–µ–Ω —Å—Ç–∞—Ä—ã–π HTTP API** –Ω–∞ Firebase Admin SDK
- **–ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `sendFCMNotificationV2()`** —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —á–µ—Ä–µ–∑ deprecated –º–µ—Ç–æ–¥—ã
- **–£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** (`src/app.ts`)
- Firebase Admin SDK **–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **Graceful handling** –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
- **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** –≤–º–µ—Å—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

### 5. **–û–±–Ω–æ–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (`.env`)
```env
# Firebase Admin SDK Configuration
FIREBASE_PROJECT_ID=your-project-id
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxx@your-project.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"
```

### 6. **–°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** (`FIREBASE_ADMIN_SETUP.md`)
- **–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è** –ø–æ–ª—É—á–µ–Ω–∏—è Service Account –∫–ª—é—á–∞
- **–ü—Ä–∏–º–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** .env —Ñ–∞–π–ª–∞
- **–°–æ–≤–µ—Ç—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏
- **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ** —Å–æ —Å—Ç–∞—Ä—ã–º –ø–æ–¥—Ö–æ–¥–æ–º

### 7. **–û–±–Ω–æ–≤–ª–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ **–ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ Firebase Admin SDK**
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å Server Key –Ω–∞ Admin SDK

### –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (HTTP API):
```javascript
// –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –º–µ—Ç–æ–¥
const response = await axios.post('https://fcm.googleapis.com/fcm/send', payload, {
  headers: { 'Authorization': `key=${FCM_SERVER_KEY}` }
});
```

### –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (Admin SDK):
```javascript
// –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥
const result = await admin.messaging().send({
  token: fcmToken,
  notification: { title, body },
  data: customData
});
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ä—ã–π (Server Key) | –ù–æ–≤—ã–π (Admin SDK) |
|--------|---------------------|-------------------|
| **API** | Legacy HTTP API | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π SDK |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | Server Key | Service Account |
| **–¢–∏–ø–∏–∑–∞—Ü–∏—è** | –†—É—á–Ω–∞—è | TypeScript –∏–∑ –∫–æ—Ä–æ–±–∫–∏ |
| **–û—à–∏–±–∫–∏** | HTTP –∫–æ–¥—ã | –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ FCM –æ—à–∏–±–∫–∏ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | HTTP –∑–∞–ø—Ä–æ—Å—ã | –ù–∞—Ç–∏–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ |
| **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** | –ë–∞–∑–æ–≤–∞—è | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è |
| **–ü–æ–¥–¥–µ—Ä–∂–∫–∞** | –£—Å—Ç–∞—Ä–µ–≤—à–∏–π | –ê–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è |

## üéØ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –∑–∞–ø—É—Å–∫–∞

### 1. –ü–æ–ª—É—á–∏—Ç—å Service Account –∫–ª—é—á
–°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ `FIREBASE_ADMIN_SETUP.md`

### 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª
```env
FIREBASE_PROJECT_ID=–≤–∞—à-project-id
FIREBASE_CLIENT_EMAIL=firebase-adminsdk-xxx@–≤–∞—à-project.iam.gserviceaccount.com
FIREBASE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n–í–ê–®_–ü–†–ò–í–ê–¢–ù–´–ô_–ö–õ–Æ–ß\n-----END PRIVATE KEY-----"
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```bash
npm run dev
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
–í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
‚úÖ Firebase Admin SDK —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
```

### 5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test-notifications-api.html` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö endpoints

## üîß –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Singleton Pattern
```typescript
const firebaseService = FirebaseAdminService.getInstance();
firebaseService.initialize(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–∏–Ω —Ä–∞–∑
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```typescript
if (error.code === 'messaging/registration-token-not-registered') {
  // FCM —Ç–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
} else if (error.code === 'messaging/invalid-registration-token') {
  // –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–æ–∫–µ–Ω–∞
}
```

### –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```typescript
const message = {
  token: fcmToken,
  notification: { title, body },
  android: {
    notification: {
      sound: 'default',
      priority: 'high'
    }
  },
  apns: {
    payload: {
      aps: {
        sound: 'default',
        badge: 1
      }
    }
  }
};
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Service Account –∫–ª—é—á–∏** –±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã —á–µ–º Server Key
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞** —á–µ—Ä–µ–∑ IAM —Ä–æ–ª–∏
- **–†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π** —á–µ—Ä–µ–∑ Firebase Console
- **–ù–∏–∫–∞–∫–∏—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤** –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ

## üìà –ì–æ—Ç–æ–≤–æ –∫ production

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production —Å:
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º Firebase Admin SDK
- ‚úÖ –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéâ**
