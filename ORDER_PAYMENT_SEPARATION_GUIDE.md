# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ API –∑–∞–∫–∞–∑–æ–≤ –∏ –æ–ø–ª–∞—Ç—ã

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∏ –æ–ø–ª–∞—Ç—ã

**–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- –û–¥–∏–Ω endpoint `POST /api/orders/create-user-order` —Å–æ–∑–¥–∞–≤–∞–ª –∑–∞–∫–∞–∑ –∏ —Å—Ä–∞–∑—É –ø—ã—Ç–∞–ª—Å—è –µ–≥–æ –æ–ø–ª–∞—Ç–∏—Ç—å
- –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∞, –∑–∞–∫–∞–∑ –≤—Å–µ —Ä–∞–≤–Ω–æ —Å–æ–∑–¥–∞–≤–∞–ª—Å—è
- –¢—Ä—É–¥–Ω–æ –±—ã–ª–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å —ç—Ç–∞–ø—ã –ø—Ä–æ—Ü–µ—Å—Å–∞

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
- `POST /api/orders/create-user-order` - —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑
- `POST /api/orders/:id/pay` - –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint –¥–ª—è –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞
- –õ—É—á—à–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

### üÜï –ù–æ–≤—ã–µ endpoints

#### 1. POST `/api/orders/:id/pay` - –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞
```bash
curl -X POST http://localhost:3000/api/orders/12345/pay \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"card_id": 789}'
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:**
- ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞
- ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤
- ‚ùå –ó–∞–∫–∞–∑ —É–∂–µ –æ–ø–ª–∞—á–µ–Ω
- ‚ùå –ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω
- ‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω

#### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π POST `/api/orders/create-user-order`
–¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑, –Ω–µ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –µ–≥–æ.

**–ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω `card_id`:**
```json
{
  "success": true,
  "data": {
    "order_id": 12345,
    "order_uuid": "175372009812345",
    "message": "–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω. –î–ª—è –æ–ø–ª–∞—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ POST /api/orders/12345/pay"
  }
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö —É—Å–ª–æ–≤–∏–π
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

### üéØ –ö–æ–Ω—Ç—Ä–æ–ª—å
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏ –æ–ø–ª–∞—Ç–∏—Ç—å –ø–æ–∑–∂–µ
- –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –æ–ø–ª–∞—Ç—ã
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–ø–ª–∞—Ç—É –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –û—Ç–¥–µ–ª—å–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –æ–ø–ª–∞—Ç—ã
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—É—Å–∞—Ö –ø–ª–∞—Ç–µ–∂–µ–π
- –ü—Ä–æ—â–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ —Å—Ç–∞–ª–∏ –±—ã—Å—Ç—Ä–µ–µ
- –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –±–∞–Ω–∫–æ–º
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–ø–ª–∞—Ç—ã

## –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

### –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (deprecated):
```javascript
// –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–ø–ª–∞—Ç–∞ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ
const response = await fetch('/api/orders/create-user-order', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    business_id: 1,
    items: [...],
    card_id: 789  // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
  })
});
```

### –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):
```javascript
// –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
const orderResponse = await fetch('/api/orders/create-user-order', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    business_id: 1,
    items: [...]
  })
});

const { order_id } = orderResponse.data;

// –®–∞–≥ 2: –û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞
const paymentResponse = await fetch(`/api/orders/${order_id}/pay`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    card_id: 789
  })
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã
if (paymentResponse.data.payment_result.status === 'ok') {
  console.log('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω!');
} else {
  console.log('–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã:', paymentResponse.data.payment_result);
}
```

## –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –ú–æ–∂–Ω–æ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å |
|--------|----------|------------------|
| 66     | –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ | ‚úÖ –î–∞ |
| 0      | –û–ø–ª–∞—á–µ–Ω | ‚ùå –£–∂–µ –æ–ø–ª–∞—á–µ–Ω |
| 1      | –ü—Ä–∏–Ω—è—Ç –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É | ‚ùå –ù–µ—Ç |
| 2      | –°–æ–±—Ä–∞–Ω | ‚ùå –ù–µ—Ç |
| 3      | –ü–µ—Ä–µ–¥–∞–Ω –∫—É—Ä—å–µ—Ä—É | ‚ùå –ù–µ—Ç |
| 4      | –í –ø—É—Ç–∏ | ‚ùå –ù–µ—Ç |
| 5      | –î–æ—Å—Ç–∞–≤–ª–µ–Ω | ‚ùå –ù–µ—Ç |
| 99     | –û—Ç–º–µ–Ω–µ–Ω | ‚ùå –ù–µ—Ç |

## –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|----------|----------|
| `ok` | –£—Å–ø–µ—à–Ω–æ | –ó–∞–∫–∞–∑ –æ–ø–ª–∞—á–µ–Ω |
| `insufficient_funds` | –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ | –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç—É |
| `bad_request` | –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã |
| `forbidden` | –û–ø–µ—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ |
| `server_error` | –û—à–∏–±–∫–∞ –±–∞–Ω–∫–∞ | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∑–∂–µ |
| `unknown` | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ | –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É |

## –ü—Ä–∏–º–µ—Ä—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –æ–ø–ª–∞—Ç—ã
```javascript
const paymentResponse = await fetch(`/api/orders/${orderId}/pay`, {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
  body: JSON.stringify({ card_id: cardId })
});

const result = await paymentResponse.json();

switch (result.data.payment_result.status) {
  case 'ok':
    showSuccess('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω!');
    break;
  case 'insufficient_funds':
    showError('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –∫–∞—Ä—Ç–µ');
    // –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç—É
    break;
  case 'server_error':
    showError('–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –±–∞–Ω–∫–æ–º. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
    break;
  default:
    showError('–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã: ' + result.data.payment_result.error_detail);
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞:
```bash
curl -X POST http://localhost:3000/api/orders/create-user-order \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"business_id": 1, "items": [{"item_id": 123, "amount": 1}]}'
```

### –¢–µ—Å—Ç –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞:
```bash
curl -X POST http://localhost:3000/api/orders/ORDER_ID/pay \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"card_id": 789}'
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∏ –æ–ø–ª–∞—Ç—ã —É–ª—É—á—à–∞–µ—Ç:
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- üéØ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –ª—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- üìà **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- üõ† **–û—Ç–ª–∞–¥–∫—É** - –ø—Ä–æ—â–µ –Ω–∞—Ö–æ–¥–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
- üí° **UX** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
