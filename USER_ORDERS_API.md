# User Orders API Documentation

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–≤–æ–∏—Ö –∑–∞–∫–∞–∑–∞—Ö:
- –í—Å–µ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏)

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
```
Authorization: Bearer <your_jwt_token>
```

## üìñ –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**GET** `/api/orders/my-orders`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

#### Query Parameters

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `page` | number | –ù–µ—Ç | –ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 1) |
| `limit` | number | –ù–µ—Ç | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 20, –º–∞–∫—Å–∏–º—É–º: 50) |
| `status` | number | –ù–µ—Ç | –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–∫–∞–∑–∞ |
| `business_id` | number | –ù–µ—Ç | –§–∏–ª—å—Ç—Ä –ø–æ ID –±–∏–∑–Ω–µ—Å–∞ |
| `delivery_type` | string | –ù–µ—Ç | –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –¥–æ—Å—Ç–∞–≤–∫–∏ (DELIVERY, PICKUP, SCHEDULED) |

#### –í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤

- `66` - –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- `0` - –û–ø–ª–∞—á–µ–Ω
- `1` - –ü—Ä–∏–Ω—è—Ç –≤ —Ä–∞–±–æ—Ç—É
- `2` - –ì–æ—Ç–æ–≤–∏—Ç—Å—è
- `3` - –î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è
- `4` - –î–æ—Å—Ç–∞–≤–ª–µ–Ω

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```bash
curl -X GET "http://localhost:3000/api/orders/my-orders?page=1&limit=10&status=0" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "success": true,
  "data": {
    "orders": [
      {
        "order_id": 123,
        "order_uuid": "1723456789123456",
        "business": {
          "business_id": 2,
          "name": "–ú–∞–≥–∞–∑–∏–Ω –∞–ª–∫–æ–≥–æ–ª—è",
          "address": "—É–ª. –ü—É—à–∫–∏–Ω–∞, 10",
          "logo": "logo.png",
          "img": "business.jpg"
        },
        "delivery_type": "DELIVERY",
        "delivery_date": null,
        "delivery_price": 500,
        "bonus_used": 0,
        "extra": "",
        "log_timestamp": "2024-08-05T10:30:00.000Z",
        "is_canceled": 0,
        "current_status": {
          "status": 0,
          "status_description": "–û–ø–ª–∞—á–µ–Ω",
          "is_canceled": 0,
          "log_timestamp": "2024-08-05T10:35:00.000Z"
        },
        "delivery_address": {
          "address_id": 45,
          "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 25",
          "name": "–î–æ–º",
          "apartment": "15",
          "entrance": "2",
          "floor": "3",
          "other": "–ö–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ 1234",
          "lat": 52.271643,
          "lon": 76.950011
        },
        "items": [
          {
            "relation_id": 789,
            "item_id": 100,
            "name": "–í–æ–¥–∫–∞ Premium",
            "description": "–ü—Ä–µ–º–∏—É–º –≤–æ–¥–∫–∞ 40%",
            "img": "vodka.jpg",
            "amount": 2,
            "price": 3500,
            "unit": "—à—Ç",
            "total_cost": 7000
          }
        ],
        "cost_summary": {
          "items_total": 7000,
          "delivery_price": 500,
          "bonus_used": 0,
          "total_sum": 7500
        }
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 10,
      "total": 25,
      "total_pages": 3
    },
    "filters_applied": {
      "status": 0,
      "business_id": null,
      "delivery_type": null
    }
  },
  "message": "–ù–∞–π–¥–µ–Ω–æ 25 –∑–∞–∫–∞–∑–æ–≤"
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**GET** `/api/orders/my-active-orders`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç–∞—Ç—É—Å—ã 0-5, 66), –∏—Å–∫–ª—é—á–∞—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∏ –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ.

#### Query Parameters

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `business_id` | number | –ù–µ—Ç | –§–∏–ª—å—Ç—Ä –ø–æ ID –±–∏–∑–Ω–µ—Å–∞ |
| `delivery_type` | string | –ù–µ—Ç | –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –¥–æ—Å—Ç–∞–≤–∫–∏ (DELIVERY, PICKUP, SCHEDULED) |

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

```bash
curl -X GET "http://localhost:3000/api/orders/my-active-orders" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
  "success": true,
  "data": {
    "active_orders": [
      {
        "order_id": 124,
        "order_uuid": "1723456789124456",
        "business": {
          "business_id": 2,
          "name": "–ú–∞–≥–∞–∑–∏–Ω –∞–ª–∫–æ–≥–æ–ª—è",
          "address": "—É–ª. –ü—É—à–∫–∏–Ω–∞, 10",
          "logo": "logo.png",
          "img": "business.jpg"
        },
        "delivery_type": "DELIVERY",
        "delivery_date": null,
        "log_timestamp": "2024-08-05T11:00:00.000Z",
        "current_status": {
          "status": 2,
          "status_description": "–ì–æ—Ç–æ–≤–∏—Ç—Å—è",
          "status_color": "#9c27b0",
          "priority": 4,
          "is_canceled": 0,
          "log_timestamp": "2024-08-05T11:15:00.000Z"
        },
        "delivery_address": {
          "address_id": 45,
          "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, 25",
          "name": "–î–æ–º",
          "apartment": "15",
          "entrance": "2",
          "floor": "3",
          "other": "–ö–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞ 1234",
          "lat": 52.271643,
          "lon": 76.950011
        },
        "items_summary": {
          "items_count": 3,
          "total_amount": 5,
          "items_preview": [
            {
              "name": "–í–æ–¥–∫–∞ Premium",
              "img": "vodka.jpg",
              "amount": 2
            },
            {
              "name": "–ü–∏–≤–æ —Å–≤–µ—Ç–ª–æ–µ",
              "img": "beer.jpg",
              "amount": 3
            }
          ]
        },
        "cost_summary": {
          "total_sum": 8500,
          "delivery_price": 500,
          "bonus_used": 0
        }
      }
    ],
    "total_active": 1,
    "filters_applied": {
      "business_id": null,
      "delivery_type": null
    }
  },
  "message": "–ù–∞–π–¥–µ–Ω–æ 1 –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤"
}
```

## üéØ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã
- –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏: 66 (–æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã), 0-4 (–≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ/–¥–æ—Å—Ç–∞–≤–∫–µ)
- –ò—Å–∫–ª—é—á–∞—é—Ç—Å—è –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ (—Å—Ç–∞—Ç—É—Å 5) –∏ –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã
- –°–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É —Å—Ç–∞—Ç—É—Å–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è

### –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- –î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç: 50 –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
- –ü–æ —Å—Ç–∞—Ç—É—Å—É –∑–∞–∫–∞–∑–∞ (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
- –ü–æ ID –±–∏–∑–Ω–µ—Å–∞
- –ü–æ —Ç–∏–ø—É –¥–æ—Å—Ç–∞–≤–∫–∏

## ‚ùå –û—à–∏–±–∫–∏

### 401 Unauthorized
```json
{
  "success": false,
  "error": {
    "message": "–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è",
    "statusCode": 401,
    "timestamp": "2024-08-05T12:00:00.000Z"
  }
}
```

### 500 Internal Server Error
```json
{
  "success": false,
  "error": {
    "message": "–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤: Database connection failed",
    "statusCode": 500,
    "timestamp": "2024-08-05T12:00:00.000Z"
  }
}
```

## üîÑ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

### React/JavaScript –ø—Ä–∏–º–µ—Ä

```javascript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
const fetchUserOrders = async (filters = {}) => {
  const params = new URLSearchParams(filters);
  
  const response = await fetch(`/api/orders/my-orders?${params}`, {
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
  });
  
  const data = await response.json();
  
  if (data.success) {
    return data.data.orders;
  } else {
    throw new Error(data.error?.message || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤');
  }
};

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
const fetchActiveOrders = async () => {
  const response = await fetch('/api/orders/my-active-orders', {
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
  });
  
  const data = await response.json();
  
  if (data.success) {
    return data.data.active_orders;
  } else {
    throw new Error(data.error?.message || '–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤');
  }
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
try {
  const orders = await fetchUserOrders({ status: 0, page: 1 });
  const activeOrders = await fetchActiveOrders();
  
  console.log('–í—Å–µ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã:', orders);
  console.log('–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã:', activeOrders);
} catch (error) {
  console.error('–û—à–∏–±–∫–∞:', error.message);
}
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–∫–∞–∑–æ–≤
2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã
3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è UX
4. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π —Ä–µ—Ñ—Ä–µ—à –∏–ª–∏ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
