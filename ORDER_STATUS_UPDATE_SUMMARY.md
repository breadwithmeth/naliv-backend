# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ BusinessController

### –ü—Ä–æ–±–ª–µ–º–∞
–†–∞–Ω–µ–µ –≤ –æ—Ç—á–µ—Ç–∞—Ö –ø–æ –∫—É—Ä—å–µ—Ä–∞–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å –ø–æ–ª–µ `current_status` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `orders`, —á—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç—è–º.

### –†–µ—à–µ–Ω–∏–µ
–û–±–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `order_status`:

#### 1. `getCouriersDeliveryReport()`
**–î–æ:**
```sql
WHERE o.current_status = 4
```

**–ü–æ—Å–ª–µ:**
```sql
LEFT JOIN (
  SELECT 
    order_id, 
    status,
    ROW_NUMBER() OVER (PARTITION BY order_id ORDER BY log_timestamp DESC) as rn
  FROM order_status
) os ON o.order_id = os.order_id AND os.rn = 1
WHERE os.status = 4
```

#### 2. `getCourierDetailedReport()`
–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –æ—Ç—á–µ—Ç—É –ø–æ –∫—É—Ä—å–µ—Ä—É.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–¢–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ç–∞—Ç—É—Å–æ–≤
2. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—è `current_status`
3. **–ì–∏–±–∫–æ—Å—Ç—å**: –ü–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–æ–≤

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –ø–æ –∫—É—Ä—å–µ—Ä–∞–º
```bash
GET /api/business/couriers/delivery-report?start_date=2024-01-01&end_date=2024-01-31
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –ø–æ –∫—É—Ä—å–µ—Ä—É
```bash
GET /api/business/couriers/123/detailed-report?start_date=2024-01-01&end_date=2024-01-31
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–ü–æ–¥–∑–∞–ø—Ä–æ—Å**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ROW_NUMBER()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ç—É—Å–∞
- **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: –ü–æ `log_timestamp DESC` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∞–º–æ–≥–æ —Å–≤–µ–∂–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: `rn = 1` –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞

### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã - API –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–µ–º –∂–µ, –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
