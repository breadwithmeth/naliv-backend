# üè¶ API –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç –∏–∑ Halyk Bank

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Halyk Bank: https://epayment.kz/docs/poluchenie-spiska-kart

## üéØ –ù–æ–≤—ã–µ API –º–µ—Ç–æ–¥—ã

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç –∏–∑ Halyk Bank API

**Endpoint:** `GET /api/payments/saved-cards/:accountId`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä—è–º–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç –∏–∑ API Halyk Bank

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
Authorization: Bearer YOUR_JWT_TOKEN
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `accountId` (string) - ID –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—ã—á–Ω–æ user_id)

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "cards": [
      {
        "halyk_id": "6845e5d5-35cc-428e-bd95-e85f78cb59d1",
        "transaction_id": "a4b8c500-ddbf-4475-b512-60cd5a9189f7",
        "merchant_id": "1a8ca610-73eb-4996-a2ef-5ec1d57bf573",
        "card_hash": "ac2d26319b1910692db0e357e88a3d02cd9e7867d72e6d2c6f4f48e61a46201e",
        "card_mask": "4405...2283",
        "payer_name": "TEST",
        "reference": "034680043232",
        "int_reference": "005224F86969006E",
        "token": "A5011A20B136418774169BC24030C63B",
        "terminal": "98458031",
        "created_date": "2020-12-11T15:47:58.828909+06:00",
        "payment_available": false,
        "account_id": "testuser1"
      }
    ],
    "total": 1,
    "source": "halyk_api",
    "account_id": "252"
  },
  "message": "–ù–∞–π–¥–µ–Ω–æ 1 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç –≤ Halyk Bank"
}
```

**–ï—Å–ª–∏ –∫–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã:**
```json
{
  "success": true,
  "data": {
    "cards": [],
    "total": 0,
    "source": "halyk_api"
  },
  "message": "–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
}
```

---

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∫–∞—Ä—Ç

**Endpoint:** `GET /api/payments/saved-cards-combined`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –∫–∞—Ä—Ç –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –∏ Halyk Bank API —Å –¥–µ—É–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
Authorization: Bearer YOUR_JWT_TOKEN
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "cards": [
      {
        "card_id": 45,
        "halyk_id": "6845e5d5-35cc-428e-bd95-e85f78cb59d1",
        "card_mask": "4405...2283",
        "payer_name": "TEST",
        "created_date": "2020-12-11T15:47:58.828909+06:00",
        "payment_available": false,
        "source": "halyk_api",
        "local_record": true
      },
      {
        "card_id": 46,
        "halyk_id": "old-card-id-123",
        "card_mask": "**** **** **** 1234",
        "payer_name": null,
        "created_date": null,
        "payment_available": null,
        "source": "local_db",
        "local_record": true
      }
    ],
    "total": 2,
    "sources": {
      "halyk_api": 1,
      "local_db": 2,
      "combined": 2
    }
  },
  "message": "–ù–∞–π–¥–µ–Ω–æ 2 —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç (1 –∏–∑ Halyk API + 2 –ª–æ–∫–∞–ª—å–Ω—ã—Ö)"
}
```

---

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Endpoint:** `GET /api/user/cards`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π API –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞—Ä—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

**–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
```
Authorization: Bearer YOUR_JWT_TOKEN
```

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `source` (string, optional) - –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö:
  - `local` - —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ)
  - `halyk` - —Ç–æ–ª—å–∫–æ Halyk Bank API
  - `combined` - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

**–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:**
```
GET /api/user/cards?source=local     # –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î
GET /api/user/cards?source=halyk     # –¢–æ–ª—å–∫–æ Halyk Bank API  
GET /api/user/cards?source=combined  # –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
GET /api/user/cards                  # –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Halyk Bank API

–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ https://epayment.kz/docs/poluchenie-spiska-kart:

**URL TEST:** `GET https://testepay.homebank.kz/api/cards/:accountId`
**URL PROD:** `GET https://epay-api.homebank.kz/cards/:accountId`

**Headers:**
```
Authorization: Bearer {access_token}
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:**
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥ `PaymentController.getHalykToken()` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
- amount: '0'
- currency: 'KZT' 
- scope: –≤–∫–ª—é—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ API –∫–∞—Ä—Ç

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ö–æ–¥ 1373 - –ó–∞–ø–∏—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã:**
```json
{
  "code": 1373,
  "message": "–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
}
```

**–î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏:**
```json
{
  "code": 100,
  "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

### –î–µ—É–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∫–∞—Ä—Ç

–ü—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö:
1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç Halyk Bank API** - —Å—á–∏—Ç–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º
2. **–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ halyk_card_id** - –∫–ª—é—á –¥–ª—è –¥–µ—É–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
3. **–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏** - –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ API

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

–°–æ–∑–¥–∞–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `test-halyk-cards-api.html` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤:

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –∑–∞–≥—Ä—É–∑–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞
2. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤** - –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î, Halyk API, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
4. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ `test-halyk-cards-api.html`
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω (–∫–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞" –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤—Ä—É—á–Ω—É—é)
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
4. –ò–∑—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

```mermaid
sequenceDiagram
    participant C as Client
    participant API as Backend API
    participant DB as Local Database
    participant H as Halyk Bank API

    C->>API: GET /api/user/cards?source=combined
    API->>DB: –ü–æ–ª—É—á–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã
    DB-->>API: –õ–æ–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã
    API->>H: GET /cards/:accountId
    H-->>API: –ö–∞—Ä—Ç—ã –∏–∑ Halyk Bank
    API->>API: –î–µ—É–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
    API-->>C: –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –ö–∞—Ä—Ç–∞ –∏–∑ Halyk Bank API
```typescript
interface HalykCard {
  ID: string;                    // "6845e5d5-35cc-428e-bd95-e85f78cb59d1"
  TransactionId: string;         // "a4b8c500-ddbf-4475-b512-60cd5a9189f7"  
  MerchantID: string;           // "1a8ca610-73eb-4996-a2ef-5ec1d57bf573"
  CardHash: string;             // "ac2d26319b1910692db0e357e88a3d02cd9e7867d72e6d2c6f4f48e61a46201e"
  CardMask: string;             // "4405...2283"
  PayerName: string;            // "TEST"
  Reference: string;            // "034680043232"
  IntReference: string;         // "005224F86969006E"  
  Token: string;                // "A5011A20B136418774169BC24030C63B"
  Terminal: string;             // "98458031"
  CreatedDate: string;          // "2020-12-11T15:47:58.828909+06:00"
  PaymentAvailable: boolean;    // false
  AccountID: string;            // "testuser1"
}
```

### –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞
```typescript
interface CombinedCard {
  card_id?: number;             // ID –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î (–º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å)
  halyk_id: string;             // ID –≤ Halyk Bank
  card_mask: string;            // –ú–∞—Å–∫–∞ –∫–∞—Ä—Ç—ã
  payer_name?: string;          // –ò–º—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ (–∏–∑ Halyk API)
  created_date?: string;        // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (–∏–∑ Halyk API) 
  payment_available?: boolean;  // –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è –æ–ø–ª–∞—Ç—ã (–∏–∑ Halyk API)
  source: 'halyk_api' | 'local_db' | 'combined';
  local_record: boolean;        // –ï—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
}
```

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ù–æ–≤—ã–µ API –º–µ—Ç–æ–¥—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

- ‚úÖ –ü—Ä—è–º–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–∞—Ä—Ç –∏–∑ Halyk Bank API
- ‚úÖ –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î
- ‚úÖ –î–µ—É–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- ‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è TypeScript

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ API –∏—Å–ø–æ–ª—å–∑—É—è `test-halyk-cards-api.html`
2. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –≤ –≤–∞—à —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã API –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
