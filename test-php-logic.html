<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ API –Ω–∞ –æ—Å–Ω–æ–≤–µ PHP –ª–æ–≥–∏–∫–∏</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            background: white; 
            padding: 25px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            margin-bottom: 20px;
        }
        .test-button { 
            background: #007cba; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 16px; 
            margin: 10px 5px;
        }
        .test-button:hover { background: #005a85; }
        .result { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            border-radius: 4px; 
            padding: 15px; 
            margin: 10px 0; 
            font-family: monospace; 
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .info { background: #e3f2fd; border-color: #2196f3; }
        h1 { color: #333; }
        h2 { color: #007cba; margin-top: 30px; }
        .explanation { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .input-group { margin: 15px 0; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .input-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .php-comparison { background: #e8f5e8; border: 1px solid #c3e6c3; padding: 15px; border-radius: 4px; margin: 15px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –¢–µ—Å—Ç –Ω–æ–≤–æ–≥–æ API –Ω–∞ –æ—Å–Ω–æ–≤–µ PHP –ª–æ–≥–∏–∫–∏</h1>
        
        <div class="explanation">
            <h3>üìã –ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞:</h3>
            <p><strong>–û—Å–Ω–æ–≤–∞:</strong> –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ PHP —Ñ—É–Ω–∫—Ü–∏–∏ <code>createOrder4()</code></p>
            <p><strong>UUID:</strong> <code>time() + order_id</code> –∫–∞–∫ –≤ PHP</p>
            <p><strong>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:</strong> –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Prisma —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</p>
            <p><strong>–ü–ª–∞—Ç–µ–∂–∏:</strong> –¢–æ—á–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ PHP —Ñ—É–Ω–∫—Ü–∏–∏ <code>pay2()</code></p>
            <p><strong>–¢–æ–∫–µ–Ω—ã:</strong> –ò–¥–µ–Ω—Ç–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ <code>getToken()</code></p>
        </div>

        <div class="php-comparison">
            <h3>üìù –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å PHP:</h3>
            <ul>
                <li>‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (business_id, user_id, address_id, delivery_price, extra)</li>
                <li>‚úÖ UUID –≥–µ–Ω–µ—Ä–∞—Ü–∏—è: time() + order_id</li>
                <li>‚úÖ –°—Ç–∞—Ç—É—Å 66 –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞</li>
                <li>‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤</li>
                <li>‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ü–µ–Ω –∏–∑ —Ç–∞–±–ª–∏—Ü—ã prices</li>
                <li>‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–ø—Ü–∏–π —Å parent_amount</li>
                <li>‚úÖ –ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (25% –æ—Ç —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞)</li>
                <li>‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Halyk Bank API</li>
                <li>‚úÖ –°—Ç–∞—Ç—É—Å 0 –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–∞</li>
            </ul>
        </div>

        <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h2>
        
        <div class="input-group">
            <label for="tokenInput">Bearer —Ç–æ–∫–µ–Ω:</label>
            <input type="text" id="tokenInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏">
        </div>

        <button class="test-button" onclick="testCreateOrder()">–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)</button>
        <button class="test-button" onclick="testWithBonus()">–¢–µ—Å—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–æ–Ω—É—Å–æ–≤</button>
        <button class="test-button" onclick="testWithOptions()">–¢–µ—Å—Ç —Å –æ–ø—Ü–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤</button>

        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        
        function getToken() {
            const token = document.getElementById('tokenInput').value.trim();
            if (!token) {
                showResult('‚ùå –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏', 'error');
                return null;
            }
            return token;
        }

        async function testCreateOrder() {
            const token = getToken();
            if (!token) return;

            showResult('–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ –ø–æ –Ω–æ–≤–æ–π PHP-–ª–æ–≥–∏–∫–µ...', 'info');
            
            try {
                // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ PHP —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                const testData = {
                    business_id: 1,
                    items: [
                        {
                            item_id: 1,
                            amount: 2
                            // –¶–µ–Ω–∞ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–±–ª–∏—Ü–∞ items –∏–ª–∏ prices)
                        }
                    ],
                    delivery: true, // boolean –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏
                    bonus: false, // –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–Ω—É—Å—ã
                    extra: JSON.stringify({test: '–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑'}),
                    card_id: 1 // ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–π –∫–∞—Ä—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø–ª–∞—Ç—ã
                };

                const response = await fetch(`${API_BASE}/orders/create-user-order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(testData)
                });

                const data = await response.json();
                
                if (data.success) {
                    showResult(`‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!
                    
–ù–æ–≤–∞—è PHP-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
- UUID: –≤—Ä–µ–º—è + order_id
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤
- –¶–µ–Ω—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–ª–∞—Ç–∞ –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω–∞

–†–µ–∑—É–ª—å—Ç–∞—Ç: ${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞: ${data.error}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        async function testWithBonus() {
            const token = getToken();
            if (!token) return;

            showResult('–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–æ–Ω—É—Å–æ–≤...', 'info');
            
            try {
                const testData = {
                    business_id: 1,
                    items: [
                        {
                            item_id: 1,
                            amount: 3
                        }
                    ],
                    delivery: true,
                    bonus: true, // –≤–∫–ª—é—á–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤ (25% –æ—Ç —Å—É–º–º—ã)
                    extra: JSON.stringify({test: '–ó–∞–∫–∞–∑ —Å –±–æ–Ω—É—Å–∞–º–∏'}),
                    card_id: 1
                };

                const response = await fetch(`${API_BASE}/orders/create-user-order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(testData)
                });

                const data = await response.json();
                
                showResult(data.success ? 
                    `‚úÖ –ó–∞–∫–∞–∑ —Å –±–æ–Ω—É—Å–∞–º–∏ —Å–æ–∑–¥–∞–Ω!\n\n${JSON.stringify(data, null, 2)}` :
                    `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 
                    data.success ? 'success' : 'error'
                );
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        async function testWithOptions() {
            const token = getToken();
            if (!token) return;

            showResult('–¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å –æ–ø—Ü–∏—è–º–∏ —Ç–æ–≤–∞—Ä–æ–≤...', 'info');
            
            try {
                const testData = {
                    business_id: 1,
                    items: [
                        {
                            item_id: 1,
                            amount: 1,
                            options: [
                                {
                                    option_item_relation_id: 1,
                                    price: 500,
                                    parent_amount: 1 // 1 –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–≤–∞—Ä = 1 –æ–ø—Ü–∏—è
                                }
                            ]
                        }
                    ],
                    delivery: false, // –±–µ–∑ –¥–æ—Å—Ç–∞–≤–∫–∏
                    bonus: false,
                    extra: JSON.stringify({test: '–ó–∞–∫–∞–∑ —Å –æ–ø—Ü–∏—è–º–∏'}),
                    card_id: 1
                };

                const response = await fetch(`${API_BASE}/orders/create-user-order`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(testData)
                });

                const data = await response.json();
                
                showResult(data.success ? 
                    `‚úÖ –ó–∞–∫–∞–∑ —Å –æ–ø—Ü–∏—è–º–∏ —Å–æ–∑–¥–∞–Ω!\n\n${JSON.stringify(data, null, 2)}` :
                    `‚ùå –û—à–∏–±–∫–∞: ${data.error}`, 
                    data.success ? 'success' : 'error'
                );
            } catch (error) {
                showResult(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            }
        }

        function showResult(message, type) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        window.onload = function() {
            showResult(`üöÄ –ù–æ–≤—ã–π Naliv Backend API - PHP Logic Implementation

–°–µ—Ä–≤–µ—Ä: ${API_BASE}
–°—Ç–∞—Ç—É—Å: –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

–ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ PHP –∫–æ–¥–µ:
‚úÖ createOrder4() - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
‚úÖ pay2() - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø–ª–∞—Ç–∞
‚úÖ getToken() - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ Halyk Bank

–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É!`, 'info');
        };
    </script>
</body>
</html>
