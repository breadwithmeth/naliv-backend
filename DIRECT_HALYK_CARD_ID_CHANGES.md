# Изменения в API оплаты сохраненной картой - Прямой Halyk Card ID

## Что изменилось

### До изменений:
- API искал карту в локальной таблице `halyk_saved_cards` по `card_id`
- Требовалось предварительно сохранить карту в системе
- Использовался внутренний ID карты из базы данных

### После изменений:
- API принимает прямой `card_id` из системы Halyk Bank
- Не требуется поиск в локальной таблице
- Напрямую передается в API Halyk Bank для оплаты

## Изменения в коде

### `orderController.ts`
1. **Метод `processCardPayment`**:
   - Изменен параметр `cardId: number` на `halykCardId: string`
   - Удален поиск карты в таблице `halyk_saved_cards`
   - Прямое использование переданного `halykCardId` в запросе к Halyk Bank

2. **Улучшена документация**:
   - Добавлены комментарии о прямом использовании Halyk Card ID
   - Обновлены JSDoc комментарии

### Документация API
1. **`SAVED_CARD_PAYMENT_API_V2_DOCS.md`**:
   - Обновлены примеры с новым форматом `card_id`
   - Изменено описание параметра `card_id`
   - Обновлена логика работы
   - Исправлены примеры кода

### Тестовый интерфейс
1. **`test-saved-card-payment-json-v2.html`**:
   - Удалена секция работы с локальными картами
   - Добавлено поле для ввода прямого Halyk Card ID
   - Упрощена логика - больше не нужно получать и выбирать карты

## Пример использования

### Запрос
```bash
curl -X POST "https://api.naliv.kz/api/orders/123/pay" \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "payment_type": "card",
    "card_id": "2d1419c5-379a-d8cd-e063-1b01010a6414"
  }'
```

### Ответ (успех)
```json
{
  "success": true,
  "data": {
    "order_id": 123,
    "payment_status": "completed",
    "halyk_response": {
      "id": "75890cc5-157a-4cce-9624-16b227c2b9ec",
      "status": "AUTH",
      "code": 0,
      ...
    }
  },
  "message": "Оплата успешно проведена"
}
```

## Преимущества

1. **Упрощение логики**: Нет необходимости управлять локальной таблицей карт
2. **Прямая интеграция**: Работа напрямую с ID карт из Halyk Bank
3. **Гибкость**: Клиент может использовать любой валидный Card ID от Halyk Bank
4. **Безопасность**: Нет хранения дополнительной информации о картах

## Обратная совместимость

⚠️ **Внимание**: Это изменение НЕ обратно совместимо с предыдущей версией API.

Клиенты должны обновить свой код для передачи прямых Halyk Card ID вместо внутренних ID из таблицы `halyk_saved_cards`.

## Тестирование

Используйте обновленный тестовый интерфейс `test-saved-card-payment-json-v2.html` с примером Card ID:
`2d1419c5-379a-d8cd-e063-1b01010a6414`

Этот ID будет передан напрямую в систему Halyk Bank для проведения оплаты.
