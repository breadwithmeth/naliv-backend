# üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ order_status –≤–º–µ—Å—Ç–æ current_status

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ BusinessController

### ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

–¢–µ–ø–µ—Ä—å –æ–±–∞ –º–µ—Ç–æ–¥–∞ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –∫—É—Ä—å–µ—Ä–∞–º –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–ø–æ—Å–ª–µ–¥–Ω—é—é –∑–∞–ø–∏—Å—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `order_status`** –≤–º–µ—Å—Ç–æ –ø–æ–ª—è `current_status` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `orders`.

### üìã –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –º–µ—Ç–æ–¥—ã

#### 1. `getCouriersDeliveryReport()`
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/business/couriers/delivery-report`
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–¥–∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ `order_status`

#### 2. `getCourierDetailedReport()`
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/business/couriers/:courierId/detailed-report`  
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `order_status`

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –ù–æ–≤—ã–π SQL –ø–æ–¥–∑–∞–ø—Ä–æ—Å:
```sql
LEFT JOIN (
  SELECT 
    order_id, 
    status,
    ROW_NUMBER() OVER (PARTITION BY order_id ORDER BY log_timestamp DESC) as rn
  FROM order_status
) os ON o.order_id = os.order_id AND os.rn = 1
WHERE os.status = 4
```

#### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã:
1. **ROW_NUMBER()** - –Ω—É–º–µ—Ä—É–µ—Ç –∑–∞–ø–∏—Å–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞
2. **ORDER BY log_timestamp DESC** - —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
3. **rn = 1** - –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω—é—é (—Å–∞–º—É—é –Ω–æ–≤—É—é) –∑–∞–ø–∏—Å—å —Å—Ç–∞—Ç—É—Å–∞
4. **os.status = 4** - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã

### üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–¢–æ—á–Ω–æ—Å—Ç—å**: –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–∞—Ç—É—Å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
2. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ù–µ –∑–∞–≤–∏—Å–∏–º –æ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—è `current_status`
3. **–ì–∏–±–∫–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π SQL —Å –æ–∫–æ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏

### üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –û—Ç—á–µ—Ç –ø–æ –≤—Å–µ–º –∫—É—Ä—å–µ—Ä–∞–º:
```bash
curl -X GET "http://localhost:3000/api/business/couriers/delivery-report" \
  -H "Authorization: Bearer business_token" \
  -G \
  -d "start_date=2024-01-01" \
  -d "end_date=2024-01-31"
```

#### –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –ø–æ –∫—É—Ä—å–µ—Ä—É:
```bash
curl -X GET "http://localhost:3000/api/business/couriers/123/detailed-report" \
  -H "Authorization: Bearer business_token" \
  -G \
  -d "start_date=2024-01-01 00:00:00" \
  -d "end_date=2024-01-31 23:59:59"
```

### üöÄ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ API –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º
- ‚úÖ –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è  
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –æ—Å—Ç–∞–ª–∏—Å—å —Ç–µ –∂–µ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ HTML —Ç–µ—Å—Ç–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∞–π–ª `test-courier-reports.html` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤.

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 12 –∞–≤–≥—É—Å—Ç–∞ 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
